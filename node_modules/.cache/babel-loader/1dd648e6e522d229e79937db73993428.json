{"ast":null,"code":"import { BigNumber } from '@ethersproject/bignumber';\nimport { JsonRpcProvider } from '@ethersproject/providers';\nimport DEFAULT_TOKEN_LIST from '@uniswap/default-token-list';\nimport { Protocol, SwapRouter } from '@uniswap/router-sdk';\nimport { Fraction, TradeType } from '@uniswap/sdk-core';\nimport { Pool, Position, SqrtPriceMath, TickMath } from '@uniswap/v3-sdk';\nimport retry from 'async-retry';\nimport JSBI from 'jsbi';\nimport _ from 'lodash';\nimport NodeCache from 'node-cache';\nimport { CachingGasStationProvider, CachingTokenProviderWithFallback, CachingV2PoolProvider, CachingV2SubgraphProvider, CachingV3PoolProvider, CachingV3SubgraphProvider, EIP1559GasPriceProvider, ETHGasStationInfoProvider, LegacyGasPriceProvider, NodeJSCache, OnChainGasPriceProvider, OnChainQuoteProvider, StaticV2SubgraphProvider, StaticV3SubgraphProvider, SwapRouterProvider, UniswapMulticallProvider, URISubgraphProvider, V2QuoteProvider, V2SubgraphProviderWithFallBacks, V3SubgraphProviderWithFallBacks } from '../../providers';\nimport { CachingTokenListProvider } from '../../providers/caching-token-list-provider';\nimport { TokenProvider } from '../../providers/token-provider';\nimport { TokenValidatorProvider } from '../../providers/token-validator-provider';\nimport { V2PoolProvider } from '../../providers/v2/pool-provider';\nimport { ArbitrumGasDataProvider, OptimismGasDataProvider } from '../../providers/v3/gas-data-provider';\nimport { V3PoolProvider } from '../../providers/v3/pool-provider';\nimport { Erc20__factory } from '../../types/other/factories/Erc20__factory';\nimport { SWAP_ROUTER_02_ADDRESSES } from '../../util';\nimport { CurrencyAmount } from '../../util/amounts';\nimport { ChainId, ID_TO_CHAIN_ID, ID_TO_NETWORK_NAME, V2_SUPPORTED } from '../../util/chains';\nimport { log } from '../../util/log';\nimport { buildSwapMethodParameters, buildTrade } from '../../util/methodParameters';\nimport { metric, MetricLoggerUnit } from '../../util/metric';\nimport { UNSUPPORTED_TOKENS } from '../../util/unsupported-tokens';\nimport { SwapToRatioStatus } from '../router';\nimport { DEFAULT_ROUTING_CONFIG_BY_CHAIN, ETH_GAS_STATION_API_URL } from './config';\nimport { getBestSwapRoute } from './functions/best-swap-route';\nimport { calculateRatioAmountIn } from './functions/calculate-ratio-amount-in';\nimport { MixedRouteHeuristicGasModelFactory } from './gas-models/mixedRoute/mixed-route-heuristic-gas-model';\nimport { V2HeuristicGasModelFactory } from './gas-models/v2/v2-heuristic-gas-model';\nimport { V3HeuristicGasModelFactory } from './gas-models/v3/v3-heuristic-gas-model';\nimport { MixedQuoter, V2Quoter, V3Quoter } from './quoters';\nexport class AlphaRouter {\n  constructor(_ref) {\n    let {\n      chainId,\n      provider,\n      multicall2Provider,\n      v3PoolProvider,\n      onChainQuoteProvider,\n      v2PoolProvider,\n      v2QuoteProvider,\n      v2SubgraphProvider,\n      tokenProvider,\n      blockedTokenListProvider,\n      v3SubgraphProvider,\n      gasPriceProvider,\n      v3GasModelFactory,\n      v2GasModelFactory,\n      mixedRouteGasModelFactory,\n      swapRouterProvider,\n      optimismGasDataProvider,\n      tokenValidatorProvider,\n      arbitrumGasDataProvider,\n      simulator\n    } = _ref;\n    this.chainId = chainId;\n    this.provider = provider;\n    this.multicall2Provider = multicall2Provider !== null && multicall2Provider !== void 0 ? multicall2Provider : new UniswapMulticallProvider(chainId, provider, 375000);\n    this.v3PoolProvider = v3PoolProvider !== null && v3PoolProvider !== void 0 ? v3PoolProvider : new CachingV3PoolProvider(this.chainId, new V3PoolProvider(ID_TO_CHAIN_ID(chainId), this.multicall2Provider), new NodeJSCache(new NodeCache({\n      stdTTL: 360,\n      useClones: false\n    })));\n    this.simulator = simulator;\n    if (onChainQuoteProvider) {\n      this.onChainQuoteProvider = onChainQuoteProvider;\n    } else {\n      switch (chainId) {\n        case ChainId.OPTIMISM:\n        case ChainId.OPTIMISM_GOERLI:\n        case ChainId.OPTIMISTIC_KOVAN:\n          this.onChainQuoteProvider = new OnChainQuoteProvider(chainId, provider, this.multicall2Provider, {\n            retries: 2,\n            minTimeout: 100,\n            maxTimeout: 1000\n          }, {\n            multicallChunk: 110,\n            gasLimitPerCall: 1200000,\n            quoteMinSuccessRate: 0.1\n          }, {\n            gasLimitOverride: 3000000,\n            multicallChunk: 45\n          }, {\n            gasLimitOverride: 3000000,\n            multicallChunk: 45\n          }, {\n            baseBlockOffset: -10,\n            rollback: {\n              enabled: true,\n              attemptsBeforeRollback: 1,\n              rollbackBlockOffset: -10\n            }\n          });\n          break;\n        case ChainId.ARBITRUM_ONE:\n        case ChainId.ARBITRUM_RINKEBY:\n        case ChainId.ARBITRUM_GOERLI:\n          this.onChainQuoteProvider = new OnChainQuoteProvider(chainId, provider, this.multicall2Provider, {\n            retries: 2,\n            minTimeout: 100,\n            maxTimeout: 1000\n          }, {\n            multicallChunk: 10,\n            gasLimitPerCall: 12000000,\n            quoteMinSuccessRate: 0.1\n          }, {\n            gasLimitOverride: 30000000,\n            multicallChunk: 6\n          }, {\n            gasLimitOverride: 30000000,\n            multicallChunk: 6\n          });\n          break;\n        case ChainId.CELO:\n        case ChainId.CELO_ALFAJORES:\n          this.onChainQuoteProvider = new OnChainQuoteProvider(chainId, provider, this.multicall2Provider, {\n            retries: 2,\n            minTimeout: 100,\n            maxTimeout: 1000\n          }, {\n            multicallChunk: 10,\n            gasLimitPerCall: 5000000,\n            quoteMinSuccessRate: 0.1\n          }, {\n            gasLimitOverride: 5000000,\n            multicallChunk: 5\n          }, {\n            gasLimitOverride: 6250000,\n            multicallChunk: 4\n          });\n          break;\n        default:\n          this.onChainQuoteProvider = new OnChainQuoteProvider(chainId, provider, this.multicall2Provider, {\n            retries: 2,\n            minTimeout: 100,\n            maxTimeout: 1000\n          }, {\n            multicallChunk: 210,\n            gasLimitPerCall: 705000,\n            quoteMinSuccessRate: 0.15\n          }, {\n            gasLimitOverride: 2000000,\n            multicallChunk: 70\n          });\n          break;\n      }\n    }\n    this.v2PoolProvider = v2PoolProvider !== null && v2PoolProvider !== void 0 ? v2PoolProvider : new CachingV2PoolProvider(chainId, new V2PoolProvider(chainId, this.multicall2Provider), new NodeJSCache(new NodeCache({\n      stdTTL: 60,\n      useClones: false\n    })));\n    this.v2QuoteProvider = v2QuoteProvider !== null && v2QuoteProvider !== void 0 ? v2QuoteProvider : new V2QuoteProvider();\n    this.blockedTokenListProvider = blockedTokenListProvider !== null && blockedTokenListProvider !== void 0 ? blockedTokenListProvider : new CachingTokenListProvider(chainId, UNSUPPORTED_TOKENS, new NodeJSCache(new NodeCache({\n      stdTTL: 3600,\n      useClones: false\n    })));\n    this.tokenProvider = tokenProvider !== null && tokenProvider !== void 0 ? tokenProvider : new CachingTokenProviderWithFallback(chainId, new NodeJSCache(new NodeCache({\n      stdTTL: 3600,\n      useClones: false\n    })), new CachingTokenListProvider(chainId, DEFAULT_TOKEN_LIST, new NodeJSCache(new NodeCache({\n      stdTTL: 3600,\n      useClones: false\n    }))), new TokenProvider(chainId, this.multicall2Provider));\n    const chainName = ID_TO_NETWORK_NAME(chainId);\n    // ipfs urls in the following format: `https://cloudflare-ipfs.com/ipns/api.uniswap.org/v1/pools/${protocol}/${chainName}.json`;\n    if (v2SubgraphProvider) {\n      this.v2SubgraphProvider = v2SubgraphProvider;\n    } else {\n      this.v2SubgraphProvider = new V2SubgraphProviderWithFallBacks([new CachingV2SubgraphProvider(chainId, new URISubgraphProvider(chainId, `https://cloudflare-ipfs.com/ipns/api.uniswap.org/v1/pools/v2/${chainName}.json`, undefined, 0), new NodeJSCache(new NodeCache({\n        stdTTL: 300,\n        useClones: false\n      }))), new StaticV2SubgraphProvider(chainId)]);\n    }\n    if (v3SubgraphProvider) {\n      this.v3SubgraphProvider = v3SubgraphProvider;\n    } else {\n      this.v3SubgraphProvider = new V3SubgraphProviderWithFallBacks([new CachingV3SubgraphProvider(chainId, new URISubgraphProvider(chainId, `https://cloudflare-ipfs.com/ipns/api.uniswap.org/v1/pools/v3/${chainName}.json`, undefined, 0), new NodeJSCache(new NodeCache({\n        stdTTL: 300,\n        useClones: false\n      }))), new StaticV3SubgraphProvider(chainId, this.v3PoolProvider)]);\n    }\n    let gasPriceProviderInstance;\n    if (this.provider instanceof JsonRpcProvider) {\n      gasPriceProviderInstance = new OnChainGasPriceProvider(chainId, new EIP1559GasPriceProvider(this.provider), new LegacyGasPriceProvider(this.provider));\n    } else {\n      gasPriceProviderInstance = new ETHGasStationInfoProvider(ETH_GAS_STATION_API_URL);\n    }\n    this.gasPriceProvider = gasPriceProvider !== null && gasPriceProvider !== void 0 ? gasPriceProvider : new CachingGasStationProvider(chainId, gasPriceProviderInstance, new NodeJSCache(new NodeCache({\n      stdTTL: 15,\n      useClones: false\n    })));\n    this.v3GasModelFactory = v3GasModelFactory !== null && v3GasModelFactory !== void 0 ? v3GasModelFactory : new V3HeuristicGasModelFactory();\n    this.v2GasModelFactory = v2GasModelFactory !== null && v2GasModelFactory !== void 0 ? v2GasModelFactory : new V2HeuristicGasModelFactory();\n    this.mixedRouteGasModelFactory = mixedRouteGasModelFactory !== null && mixedRouteGasModelFactory !== void 0 ? mixedRouteGasModelFactory : new MixedRouteHeuristicGasModelFactory();\n    this.swapRouterProvider = swapRouterProvider !== null && swapRouterProvider !== void 0 ? swapRouterProvider : new SwapRouterProvider(this.multicall2Provider, this.chainId);\n    if (chainId == ChainId.OPTIMISM || chainId == ChainId.OPTIMISTIC_KOVAN) {\n      this.l2GasDataProvider = optimismGasDataProvider !== null && optimismGasDataProvider !== void 0 ? optimismGasDataProvider : new OptimismGasDataProvider(chainId, this.multicall2Provider);\n    }\n    if (chainId == ChainId.ARBITRUM_ONE || chainId == ChainId.ARBITRUM_RINKEBY || chainId == ChainId.ARBITRUM_GOERLI) {\n      this.l2GasDataProvider = arbitrumGasDataProvider !== null && arbitrumGasDataProvider !== void 0 ? arbitrumGasDataProvider : new ArbitrumGasDataProvider(chainId, this.provider);\n    }\n    if (tokenValidatorProvider) {\n      this.tokenValidatorProvider = tokenValidatorProvider;\n    } else if (this.chainId == ChainId.MAINNET) {\n      this.tokenValidatorProvider = new TokenValidatorProvider(this.chainId, this.multicall2Provider, new NodeJSCache(new NodeCache({\n        stdTTL: 30000,\n        useClones: false\n      })));\n    }\n    // Initialize the Quoters.\n    // Quoters are an abstraction encapsulating the business logic of fetching routes and quotes.\n    this.v2Quoter = new V2Quoter(this.v2SubgraphProvider, this.v2PoolProvider, this.v2QuoteProvider, this.v2GasModelFactory, this.tokenProvider, this.chainId, this.blockedTokenListProvider, this.tokenValidatorProvider);\n    this.v3Quoter = new V3Quoter(this.v3SubgraphProvider, this.v3PoolProvider, this.onChainQuoteProvider, this.tokenProvider, this.chainId, this.blockedTokenListProvider, this.tokenValidatorProvider);\n    this.mixedQuoter = new MixedQuoter(this.v3SubgraphProvider, this.v3PoolProvider, this.v2SubgraphProvider, this.v2PoolProvider, this.onChainQuoteProvider, this.tokenProvider, this.chainId, this.blockedTokenListProvider, this.tokenValidatorProvider);\n  }\n  async routeToRatio(token0Balance, token1Balance, position, swapAndAddConfig, swapAndAddOptions) {\n    let routingConfig = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : DEFAULT_ROUTING_CONFIG_BY_CHAIN(this.chainId);\n    if (token1Balance.currency.wrapped.sortsBefore(token0Balance.currency.wrapped)) {\n      [token0Balance, token1Balance] = [token1Balance, token0Balance];\n    }\n    let preSwapOptimalRatio = this.calculateOptimalRatio(position, position.pool.sqrtRatioX96, true);\n    // set up parameters according to which token will be swapped\n    let zeroForOne;\n    if (position.pool.tickCurrent > position.tickUpper) {\n      zeroForOne = true;\n    } else if (position.pool.tickCurrent < position.tickLower) {\n      zeroForOne = false;\n    } else {\n      zeroForOne = new Fraction(token0Balance.quotient, token1Balance.quotient).greaterThan(preSwapOptimalRatio);\n      if (!zeroForOne) preSwapOptimalRatio = preSwapOptimalRatio.invert();\n    }\n    const [inputBalance, outputBalance] = zeroForOne ? [token0Balance, token1Balance] : [token1Balance, token0Balance];\n    let optimalRatio = preSwapOptimalRatio;\n    let postSwapTargetPool = position.pool;\n    let exchangeRate = zeroForOne ? position.pool.token0Price : position.pool.token1Price;\n    let swap = null;\n    let ratioAchieved = false;\n    let n = 0;\n    // iterate until we find a swap with a sufficient ratio or return null\n    while (!ratioAchieved) {\n      n++;\n      if (n > swapAndAddConfig.maxIterations) {\n        log.info('max iterations exceeded');\n        return {\n          status: SwapToRatioStatus.NO_ROUTE_FOUND,\n          error: 'max iterations exceeded'\n        };\n      }\n      const amountToSwap = calculateRatioAmountIn(optimalRatio, exchangeRate, inputBalance, outputBalance);\n      if (amountToSwap.equalTo(0)) {\n        log.info(`no swap needed: amountToSwap = 0`);\n        return {\n          status: SwapToRatioStatus.NO_SWAP_NEEDED\n        };\n      }\n      swap = await this.route(amountToSwap, outputBalance.currency, TradeType.EXACT_INPUT, undefined, {\n        ...DEFAULT_ROUTING_CONFIG_BY_CHAIN(this.chainId),\n        ...routingConfig,\n        /// @dev We do not want to query for mixedRoutes for routeToRatio as they are not supported\n        /// [Protocol.V3, Protocol.V2] will make sure we only query for V3 and V2\n        protocols: [Protocol.V3, Protocol.V2]\n      });\n      if (!swap) {\n        log.info('no route found from this.route()');\n        return {\n          status: SwapToRatioStatus.NO_ROUTE_FOUND,\n          error: 'no route found'\n        };\n      }\n      const inputBalanceUpdated = inputBalance.subtract(swap.trade.inputAmount);\n      const outputBalanceUpdated = outputBalance.add(swap.trade.outputAmount);\n      const newRatio = inputBalanceUpdated.divide(outputBalanceUpdated);\n      let targetPoolPriceUpdate;\n      swap.route.forEach(route => {\n        if (route.protocol == Protocol.V3) {\n          const v3Route = route;\n          v3Route.route.pools.forEach((pool, i) => {\n            if (pool.token0.equals(position.pool.token0) && pool.token1.equals(position.pool.token1) && pool.fee == position.pool.fee) {\n              targetPoolPriceUpdate = JSBI.BigInt(v3Route.sqrtPriceX96AfterList[i].toString());\n              optimalRatio = this.calculateOptimalRatio(position, JSBI.BigInt(targetPoolPriceUpdate.toString()), zeroForOne);\n            }\n          });\n        }\n      });\n      if (!targetPoolPriceUpdate) {\n        optimalRatio = preSwapOptimalRatio;\n      }\n      ratioAchieved = newRatio.equalTo(optimalRatio) || this.absoluteValue(newRatio.asFraction.divide(optimalRatio).subtract(1)).lessThan(swapAndAddConfig.ratioErrorTolerance);\n      if (ratioAchieved && targetPoolPriceUpdate) {\n        postSwapTargetPool = new Pool(position.pool.token0, position.pool.token1, position.pool.fee, targetPoolPriceUpdate, position.pool.liquidity, TickMath.getTickAtSqrtRatio(targetPoolPriceUpdate), position.pool.tickDataProvider);\n      }\n      exchangeRate = swap.trade.outputAmount.divide(swap.trade.inputAmount);\n      log.info({\n        exchangeRate: exchangeRate.asFraction.toFixed(18),\n        optimalRatio: optimalRatio.asFraction.toFixed(18),\n        newRatio: newRatio.asFraction.toFixed(18),\n        inputBalanceUpdated: inputBalanceUpdated.asFraction.toFixed(18),\n        outputBalanceUpdated: outputBalanceUpdated.asFraction.toFixed(18),\n        ratioErrorTolerance: swapAndAddConfig.ratioErrorTolerance.toFixed(18),\n        iterationN: n.toString()\n      }, 'QuoteToRatio Iteration Parameters');\n      if (exchangeRate.equalTo(0)) {\n        log.info('exchangeRate to 0');\n        return {\n          status: SwapToRatioStatus.NO_ROUTE_FOUND,\n          error: 'insufficient liquidity to swap to optimal ratio'\n        };\n      }\n    }\n    if (!swap) {\n      return {\n        status: SwapToRatioStatus.NO_ROUTE_FOUND,\n        error: 'no route found'\n      };\n    }\n    let methodParameters;\n    if (swapAndAddOptions) {\n      methodParameters = await this.buildSwapAndAddMethodParameters(swap.trade, swapAndAddOptions, {\n        initialBalanceTokenIn: inputBalance,\n        initialBalanceTokenOut: outputBalance,\n        preLiquidityPosition: position\n      });\n    }\n    return {\n      status: SwapToRatioStatus.SUCCESS,\n      result: {\n        ...swap,\n        methodParameters,\n        optimalRatio,\n        postSwapTargetPool\n      }\n    };\n  }\n  /**\n   * @inheritdoc IRouter\n   */\n  async route(amount, quoteCurrency, tradeType, swapConfig) {\n    let partialRoutingConfig = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n    var _a;\n    metric.putMetric(`QuoteRequestedForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n    // Get a block number to specify in all our calls. Ensures data we fetch from chain is\n    // from the same block.\n    const blockNumber = (_a = partialRoutingConfig.blockNumber) !== null && _a !== void 0 ? _a : this.getBlockNumberPromise();\n    const routingConfig = _.merge({}, DEFAULT_ROUTING_CONFIG_BY_CHAIN(this.chainId), partialRoutingConfig, {\n      blockNumber\n    });\n    const {\n      currencyIn,\n      currencyOut\n    } = this.determineCurrencyInOutFromTradeType(tradeType, amount, quoteCurrency);\n    const tokenIn = currencyIn.wrapped;\n    const tokenOut = currencyOut.wrapped;\n    // Generate our distribution of amounts, i.e. fractions of the input amount.\n    // We will get quotes for fractions of the input amount for different routes, then\n    // combine to generate split routes.\n    const [percents, amounts] = this.getAmountDistribution(amount, routingConfig);\n    const gasPriceWei = await this.getGasPriceWei();\n    const quoteToken = quoteCurrency.wrapped;\n    const quotePromises = [];\n    const [v3gasModel, mixedRouteGasModel] = await this.getGasModels(gasPriceWei, amount.currency.wrapped, quoteToken);\n    // Create a Set to sanitize the protocols input, a Set of undefined becomes an empty set,\n    // Then create an Array from the values of that Set.\n    const protocols = Array.from(new Set(routingConfig.protocols).values());\n    const noProtocolsSpecified = protocols.length == 0;\n    const v3ProtocolSpecified = protocols.includes(Protocol.V3);\n    const v2ProtocolSpecified = protocols.includes(Protocol.V2);\n    const v2SupportedInChain = V2_SUPPORTED.includes(this.chainId);\n    const shouldQueryMixedProtocol = protocols.includes(Protocol.MIXED) || noProtocolsSpecified && v2SupportedInChain;\n    const mixedProtocolAllowed = [ChainId.MAINNET, ChainId.GÖRLI].includes(this.chainId) && tradeType === TradeType.EXACT_INPUT;\n    // Maybe Quote V3 - if V3 is specified, or no protocol is specified\n    if (v3ProtocolSpecified || noProtocolsSpecified) {\n      log.info({\n        protocols,\n        tradeType\n      }, 'Routing across V3');\n      quotePromises.push(this.v3Quoter.getRoutesThenQuotes(tokenIn, tokenOut, amounts, percents, quoteToken, tradeType, routingConfig, v3gasModel));\n    }\n    // Maybe Quote V2 - if V2 is specified, or no protocol is specified AND v2 is supported in this chain\n    if (v2SupportedInChain && (v2ProtocolSpecified || noProtocolsSpecified)) {\n      log.info({\n        protocols,\n        tradeType\n      }, 'Routing across V2');\n      quotePromises.push(this.v2Quoter.getRoutesThenQuotes(tokenIn, tokenOut, amounts, percents, quoteToken, tradeType, routingConfig, undefined, gasPriceWei));\n    }\n    // Maybe Quote mixed routes\n    // if MixedProtocol is specified or no protocol is specified and v2 is supported AND tradeType is ExactIn\n    // AND is Mainnet or Gorli\n    if (shouldQueryMixedProtocol && mixedProtocolAllowed) {\n      log.info({\n        protocols,\n        tradeType\n      }, 'Routing across MixedRoutes');\n      quotePromises.push(this.mixedQuoter.getRoutesThenQuotes(tokenIn, tokenOut, amounts, percents, quoteToken, tradeType, routingConfig, mixedRouteGasModel));\n    }\n    const routesWithValidQuotesByProtocol = await Promise.all(quotePromises);\n    // The following block of code performs a manual reduce operation\n    // from the Array<RouteWithValidQuote[],CandidatePoolsBySelectionCriteria>\n    // to 2 arrays: RouteWithValidQuote[] AND CandidatePoolsBySelectionCriteria[]\n    let allRoutesWithValidQuotes = [];\n    let allCandidatePools = [];\n    for (const {\n      routesWithValidQuotes,\n      candidatePools\n    } of routesWithValidQuotesByProtocol) {\n      allRoutesWithValidQuotes = [...allRoutesWithValidQuotes, ...routesWithValidQuotes];\n      if (candidatePools) {\n        allCandidatePools = [...allCandidatePools, candidatePools];\n      }\n    }\n    if (allRoutesWithValidQuotes.length == 0) {\n      log.info({\n        allRoutesWithValidQuotes\n      }, 'Received no valid quotes');\n      return null;\n    }\n    // Given all the quotes for all the amounts for all the routes, find the best combination.\n    const beforeBestSwap = Date.now();\n    const swapRouteRaw = await getBestSwapRoute(amount, percents, allRoutesWithValidQuotes, tradeType, this.chainId, routingConfig, v3gasModel);\n    if (!swapRouteRaw) {\n      return null;\n    }\n    const {\n      quote,\n      quoteGasAdjusted,\n      estimatedGasUsed,\n      routes: routeAmounts,\n      estimatedGasUsedQuoteToken,\n      estimatedGasUsedUSD\n    } = swapRouteRaw;\n    // Build Trade object that represents the optimal swap.\n    const trade = buildTrade(currencyIn, currencyOut, tradeType, routeAmounts);\n    let methodParameters;\n    // If user provided recipient, deadline etc. we also generate the calldata required to execute\n    // the swap and return it too.\n    if (swapConfig) {\n      methodParameters = buildSwapMethodParameters(trade, swapConfig, this.chainId);\n    }\n    metric.putMetric('FindBestSwapRoute', Date.now() - beforeBestSwap, MetricLoggerUnit.Milliseconds);\n    metric.putMetric(`QuoteFoundForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n    this.emitPoolSelectionMetrics(swapRouteRaw, allCandidatePools);\n    const swapRoute = {\n      quote,\n      quoteGasAdjusted,\n      estimatedGasUsed,\n      estimatedGasUsedQuoteToken,\n      estimatedGasUsedUSD,\n      gasPriceWei,\n      route: routeAmounts,\n      trade,\n      methodParameters,\n      blockNumber: BigNumber.from(await blockNumber)\n    };\n    if (swapConfig && swapConfig.simulate && methodParameters && methodParameters.calldata) {\n      if (!this.simulator) {\n        throw new Error('Simulator not initialized!');\n      }\n      log.info({\n        swapConfig,\n        methodParameters\n      }, 'Starting simulation');\n      const fromAddress = swapConfig.simulate.fromAddress;\n      const beforeSimulate = Date.now();\n      const swapRouteWithSimulation = await this.simulator.simulate(fromAddress, swapConfig, swapRoute, amount,\n      // Quote will be in WETH even if quoteCurrency is ETH\n      // So we init a new CurrencyAmount object here\n      CurrencyAmount.fromRawAmount(quoteCurrency, quote.quotient.toString()), this.l2GasDataProvider ? await this.l2GasDataProvider.getGasData() : undefined, {\n        blockNumber\n      });\n      metric.putMetric('SimulateTransaction', Date.now() - beforeSimulate, MetricLoggerUnit.Milliseconds);\n      return swapRouteWithSimulation;\n    }\n    return swapRoute;\n  }\n  determineCurrencyInOutFromTradeType(tradeType, amount, quoteCurrency) {\n    if (tradeType == TradeType.EXACT_INPUT) {\n      return {\n        currencyIn: amount.currency,\n        currencyOut: quoteCurrency\n      };\n    } else {\n      return {\n        currencyIn: quoteCurrency,\n        currencyOut: amount.currency\n      };\n    }\n  }\n  async getGasPriceWei() {\n    // Track how long it takes to resolve this async call.\n    const beforeGasTimestamp = Date.now();\n    // Get an estimate of the gas price to use when estimating gas cost of different routes.\n    const {\n      gasPriceWei\n    } = await this.gasPriceProvider.getGasPrice();\n    metric.putMetric('GasPriceLoad', Date.now() - beforeGasTimestamp, MetricLoggerUnit.Milliseconds);\n    return gasPriceWei;\n  }\n  async getGasModels(gasPriceWei, amountToken, quoteToken) {\n    const beforeGasModel = Date.now();\n    const v3GasModelPromise = this.v3GasModelFactory.buildGasModel({\n      chainId: this.chainId,\n      gasPriceWei,\n      v3poolProvider: this.v3PoolProvider,\n      amountToken,\n      quoteToken,\n      v2poolProvider: this.v2PoolProvider,\n      l2GasDataProvider: this.l2GasDataProvider\n    });\n    const mixedRouteGasModelPromise = this.mixedRouteGasModelFactory.buildGasModel({\n      chainId: this.chainId,\n      gasPriceWei,\n      v3poolProvider: this.v3PoolProvider,\n      amountToken,\n      quoteToken,\n      v2poolProvider: this.v2PoolProvider\n    });\n    const [v3GasModel, mixedRouteGasModel] = await Promise.all([v3GasModelPromise, mixedRouteGasModelPromise]);\n    metric.putMetric('GasModelCreation', Date.now() - beforeGasModel, MetricLoggerUnit.Milliseconds);\n    return [v3GasModel, mixedRouteGasModel];\n  }\n  // Note multiplications here can result in a loss of precision in the amounts (e.g. taking 50% of 101)\n  // This is reconcilled at the end of the algorithm by adding any lost precision to one of\n  // the splits in the route.\n  getAmountDistribution(amount, routingConfig) {\n    const {\n      distributionPercent\n    } = routingConfig;\n    const percents = [];\n    const amounts = [];\n    for (let i = 1; i <= 100 / distributionPercent; i++) {\n      percents.push(i * distributionPercent);\n      amounts.push(amount.multiply(new Fraction(i * distributionPercent, 100)));\n    }\n    return [percents, amounts];\n  }\n  async buildSwapAndAddMethodParameters(trade, swapAndAddOptions, swapAndAddParameters) {\n    const {\n      swapOptions: {\n        recipient,\n        slippageTolerance,\n        deadline,\n        inputTokenPermit\n      },\n      addLiquidityOptions: addLiquidityConfig\n    } = swapAndAddOptions;\n    const preLiquidityPosition = swapAndAddParameters.preLiquidityPosition;\n    const finalBalanceTokenIn = swapAndAddParameters.initialBalanceTokenIn.subtract(trade.inputAmount);\n    const finalBalanceTokenOut = swapAndAddParameters.initialBalanceTokenOut.add(trade.outputAmount);\n    const approvalTypes = await this.swapRouterProvider.getApprovalType(finalBalanceTokenIn, finalBalanceTokenOut);\n    const zeroForOne = finalBalanceTokenIn.currency.wrapped.sortsBefore(finalBalanceTokenOut.currency.wrapped);\n    return {\n      ...SwapRouter.swapAndAddCallParameters(trade, {\n        recipient,\n        slippageTolerance,\n        deadlineOrPreviousBlockhash: deadline,\n        inputTokenPermit\n      }, Position.fromAmounts({\n        pool: preLiquidityPosition.pool,\n        tickLower: preLiquidityPosition.tickLower,\n        tickUpper: preLiquidityPosition.tickUpper,\n        amount0: zeroForOne ? finalBalanceTokenIn.quotient.toString() : finalBalanceTokenOut.quotient.toString(),\n        amount1: zeroForOne ? finalBalanceTokenOut.quotient.toString() : finalBalanceTokenIn.quotient.toString(),\n        useFullPrecision: false\n      }), addLiquidityConfig, approvalTypes.approvalTokenIn, approvalTypes.approvalTokenOut),\n      to: SWAP_ROUTER_02_ADDRESSES(this.chainId)\n    };\n  }\n  emitPoolSelectionMetrics(swapRouteRaw, allPoolsBySelection) {\n    const poolAddressesUsed = new Set();\n    const {\n      routes: routeAmounts\n    } = swapRouteRaw;\n    _(routeAmounts).flatMap(routeAmount => {\n      const {\n        poolAddresses\n      } = routeAmount;\n      return poolAddresses;\n    }).forEach(address => {\n      poolAddressesUsed.add(address.toLowerCase());\n    });\n    for (const poolsBySelection of allPoolsBySelection) {\n      const {\n        protocol\n      } = poolsBySelection;\n      _.forIn(poolsBySelection.selections, (pools, topNSelection) => {\n        const topNUsed = _.findLastIndex(pools, pool => poolAddressesUsed.has(pool.id.toLowerCase())) + 1;\n        metric.putMetric(_.capitalize(`${protocol}${topNSelection}`), topNUsed, MetricLoggerUnit.Count);\n      });\n    }\n    let hasV3Route = false;\n    let hasV2Route = false;\n    let hasMixedRoute = false;\n    for (const routeAmount of routeAmounts) {\n      if (routeAmount.protocol == Protocol.V3) {\n        hasV3Route = true;\n      }\n      if (routeAmount.protocol == Protocol.V2) {\n        hasV2Route = true;\n      }\n      if (routeAmount.protocol == Protocol.MIXED) {\n        hasMixedRoute = true;\n      }\n    }\n    if (hasMixedRoute && (hasV3Route || hasV2Route)) {\n      if (hasV3Route && hasV2Route) {\n        metric.putMetric(`MixedAndV3AndV2SplitRoute`, 1, MetricLoggerUnit.Count);\n        metric.putMetric(`MixedAndV3AndV2SplitRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n      } else if (hasV3Route) {\n        metric.putMetric(`MixedAndV3SplitRoute`, 1, MetricLoggerUnit.Count);\n        metric.putMetric(`MixedAndV3SplitRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n      } else if (hasV2Route) {\n        metric.putMetric(`MixedAndV2SplitRoute`, 1, MetricLoggerUnit.Count);\n        metric.putMetric(`MixedAndV2SplitRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n      }\n    } else if (hasV3Route && hasV2Route) {\n      metric.putMetric(`V3AndV2SplitRoute`, 1, MetricLoggerUnit.Count);\n      metric.putMetric(`V3AndV2SplitRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n    } else if (hasMixedRoute) {\n      if (routeAmounts.length > 1) {\n        metric.putMetric(`MixedSplitRoute`, 1, MetricLoggerUnit.Count);\n        metric.putMetric(`MixedSplitRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n      } else {\n        metric.putMetric(`MixedRoute`, 1, MetricLoggerUnit.Count);\n        metric.putMetric(`MixedRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n      }\n    } else if (hasV3Route) {\n      if (routeAmounts.length > 1) {\n        metric.putMetric(`V3SplitRoute`, 1, MetricLoggerUnit.Count);\n        metric.putMetric(`V3SplitRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n      } else {\n        metric.putMetric(`V3Route`, 1, MetricLoggerUnit.Count);\n        metric.putMetric(`V3RouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n      }\n    } else if (hasV2Route) {\n      if (routeAmounts.length > 1) {\n        metric.putMetric(`V2SplitRoute`, 1, MetricLoggerUnit.Count);\n        metric.putMetric(`V2SplitRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n      } else {\n        metric.putMetric(`V2Route`, 1, MetricLoggerUnit.Count);\n        metric.putMetric(`V2RouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n      }\n    }\n  }\n  calculateOptimalRatio(position, sqrtRatioX96, zeroForOne) {\n    const upperSqrtRatioX96 = TickMath.getSqrtRatioAtTick(position.tickUpper);\n    const lowerSqrtRatioX96 = TickMath.getSqrtRatioAtTick(position.tickLower);\n    // returns Fraction(0, 1) for any out of range position regardless of zeroForOne. Implication: function\n    // cannot be used to determine the trading direction of out of range positions.\n    if (JSBI.greaterThan(sqrtRatioX96, upperSqrtRatioX96) || JSBI.lessThan(sqrtRatioX96, lowerSqrtRatioX96)) {\n      return new Fraction(0, 1);\n    }\n    const precision = JSBI.BigInt('1' + '0'.repeat(18));\n    let optimalRatio = new Fraction(SqrtPriceMath.getAmount0Delta(sqrtRatioX96, upperSqrtRatioX96, precision, true), SqrtPriceMath.getAmount1Delta(sqrtRatioX96, lowerSqrtRatioX96, precision, true));\n    if (!zeroForOne) optimalRatio = optimalRatio.invert();\n    return optimalRatio;\n  }\n  async userHasSufficientBalance(fromAddress, tradeType, amount, quote) {\n    try {\n      const neededBalance = tradeType == TradeType.EXACT_INPUT ? amount : quote;\n      let balance;\n      if (neededBalance.currency.isNative) {\n        balance = await this.provider.getBalance(fromAddress);\n      } else {\n        const tokenContract = Erc20__factory.connect(neededBalance.currency.address, this.provider);\n        balance = await tokenContract.balanceOf(fromAddress);\n      }\n      return balance.gte(BigNumber.from(neededBalance.quotient.toString()));\n    } catch (e) {\n      log.error(e, 'Error while checking user balance');\n      return false;\n    }\n  }\n  absoluteValue(fraction) {\n    const numeratorAbs = JSBI.lessThan(fraction.numerator, JSBI.BigInt(0)) ? JSBI.unaryMinus(fraction.numerator) : fraction.numerator;\n    const denominatorAbs = JSBI.lessThan(fraction.denominator, JSBI.BigInt(0)) ? JSBI.unaryMinus(fraction.denominator) : fraction.denominator;\n    return new Fraction(numeratorAbs, denominatorAbs);\n  }\n  getBlockNumberPromise() {\n    return retry(async (_b, attempt) => {\n      if (attempt > 1) {\n        log.info(`Get block number attempt ${attempt}`);\n      }\n      return this.provider.getBlockNumber();\n    }, {\n      retries: 2,\n      minTimeout: 100,\n      maxTimeout: 1000\n    });\n  }\n}","map":{"version":3,"sources":["../../../../src/routers/alpha-router/alpha-router.ts"],"names":[],"mappings":"AAAA,SAAS,SAAS,QAAQ,0BAA0B;AACpD,SAAuB,eAAe,QAAQ,0BAA0B;AACxE,OAAO,kBAAkB,MAAM,6BAA6B;AAC5D,SAAS,QAAQ,EAAE,UAAU,QAAe,qBAAqB;AACjE,SAAmB,QAAQ,EAAS,SAAS,QAAQ,mBAAmB;AAExE,SAAS,IAAI,EAAE,QAAQ,EAAE,aAAa,EAAE,QAAQ,QAAQ,iBAAiB;AACzE,OAAO,KAAK,MAAM,aAAa;AAC/B,OAAO,IAAI,MAAM,MAAM;AACvB,OAAO,CAAC,MAAM,QAAQ;AACtB,OAAO,SAAS,MAAM,YAAY;AAElC,SACE,yBAAyB,EACzB,gCAAgC,EAChC,qBAAqB,EACrB,yBAAyB,EACzB,qBAAqB,EACrB,yBAAyB,EACzB,uBAAuB,EACvB,yBAAyB,EAKzB,sBAAsB,EACtB,WAAW,EACX,uBAAuB,EACvB,oBAAoB,EAEpB,wBAAwB,EACxB,wBAAwB,EACxB,kBAAkB,EAClB,wBAAwB,EACxB,mBAAmB,EACnB,eAAe,EACf,+BAA+B,EAC/B,+BAA+B,QAC1B,iBAAiB;AACxB,SAAS,wBAAwB,QAA4B,6CAA6C;AAE1G,SAAyB,aAAa,QAAQ,gCAAgC;AAC9E,SAAkC,sBAAsB,QAAS,0CAA0C;AAC3G,SAA0B,cAAc,QAAQ,kCAAkC;AAClF,SAEE,uBAAuB,EAGvB,uBAAuB,QAClB,sCAAsC;AAC7C,SAA0B,cAAc,QAAQ,kCAAkC;AAElF,SAAS,cAAc,QAAQ,4CAA4C;AAC3E,SAAS,wBAAwB,QAAQ,YAAY;AACrD,SAAS,cAAc,QAAQ,oBAAoB;AACnD,SAAS,OAAO,EAAE,cAAc,EAAE,kBAAkB,EAAE,YAAY,QAAQ,mBAAmB;AAC7F,SAAS,GAAG,QAAQ,gBAAgB;AACpC,SAAS,yBAAyB,EAAE,UAAU,QAAQ,6BAA6B;AACnF,SAAS,MAAM,EAAE,gBAAgB,QAAQ,mBAAmB;AAC5D,SAAS,kBAAkB,QAAQ,+BAA+B;AAClE,SAUE,iBAAiB,QACZ,WAAW;AAElB,SAAS,+BAA+B,EAAE,uBAAuB,QAAQ,UAAU;AAMnF,SAAS,gBAAgB,QAAQ,6BAA6B;AAC9D,SAAS,sBAAsB,QAAQ,uCAAuC;AAG9E,SAAS,kCAAkC,QAAQ,yDAAyD;AAC5G,SAAS,0BAA0B,QAAQ,wCAAwC;AACnF,SAAS,0BAA0B,QAAQ,wCAAwC;AACnF,SAA0B,WAAW,EAAE,QAAQ,EAAE,QAAQ,QAAQ,WAAW;AAsM5E,OAAM,MAAO,WAAW,CAAA;EA4BtB,WAAA,OAqBoB;IAAA,IArBR;MACV,OAAO;MACP,QAAQ;MACR,kBAAkB;MAClB,cAAc;MACd,oBAAoB;MACpB,cAAc;MACd,eAAe;MACf,kBAAkB;MAClB,aAAa;MACb,wBAAwB;MACxB,kBAAkB;MAClB,gBAAgB;MAChB,iBAAiB;MACjB,iBAAiB;MACjB,yBAAyB;MACzB,kBAAkB;MAClB,uBAAuB;MACvB,sBAAsB;MACtB,uBAAuB;MACvB;IAAS,CACS;IAClB,IAAI,CAAC,OAAO,GAAG,OAAO;IACtB,IAAI,CAAC,QAAQ,GAAG,QAAQ;IACxB,IAAI,CAAC,kBAAkB,GACrB,kBAAkB,KAAA,IAAA,IAAlB,kBAAkB,KAAA,KAAA,CAAA,GAAlB,kBAAkB,GAClB,IAAI,wBAAwB,CAAC,OAAO,EAAE,QAAQ,EAAE,MAAO,CAAC;IAC1D,IAAI,CAAC,cAAc,GACjB,cAAc,KAAA,IAAA,IAAd,cAAc,KAAA,KAAA,CAAA,GAAd,cAAc,GACd,IAAI,qBAAqB,CACvB,IAAI,CAAC,OAAO,EACZ,IAAI,cAAc,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE,IAAI,CAAC,kBAAkB,CAAC,EACpE,IAAI,WAAW,CAAC,IAAI,SAAS,CAAC;MAAE,MAAM,EAAE,GAAG;MAAE,SAAS,EAAE;IAAK,CAAE,CAAC,CAAC,CAClE;IACH,IAAI,CAAC,SAAS,GAAG,SAAS;IAE1B,IAAI,oBAAoB,EAAE;MACxB,IAAI,CAAC,oBAAoB,GAAG,oBAAoB;KACjD,MAAM;MACL,QAAQ,OAAO;QACb,KAAK,OAAO,CAAC,QAAQ;QACrB,KAAK,OAAO,CAAC,eAAe;QAC5B,KAAK,OAAO,CAAC,gBAAgB;UAC3B,IAAI,CAAC,oBAAoB,GAAG,IAAI,oBAAoB,CAClD,OAAO,EACP,QAAQ,EACR,IAAI,CAAC,kBAAkB,EACvB;YACE,OAAO,EAAE,CAAC;YACV,UAAU,EAAE,GAAG;YACf,UAAU,EAAE;WACb,EACD;YACE,cAAc,EAAE,GAAG;YACnB,eAAe,EAAE,OAAS;YAC1B,mBAAmB,EAAE;WACtB,EACD;YACE,gBAAgB,EAAE,OAAS;YAC3B,cAAc,EAAE;WACjB,EACD;YACE,gBAAgB,EAAE,OAAS;YAC3B,cAAc,EAAE;WACjB,EACD;YACE,eAAe,EAAE,CAAC,EAAE;YACpB,QAAQ,EAAE;cACR,OAAO,EAAE,IAAI;cACb,sBAAsB,EAAE,CAAC;cACzB,mBAAmB,EAAE,CAAC;YACvB;WACF,CACF;UACD;QACF,KAAK,OAAO,CAAC,YAAY;QACzB,KAAK,OAAO,CAAC,gBAAgB;QAC7B,KAAK,OAAO,CAAC,eAAe;UAC1B,IAAI,CAAC,oBAAoB,GAAG,IAAI,oBAAoB,CAClD,OAAO,EACP,QAAQ,EACR,IAAI,CAAC,kBAAkB,EACvB;YACE,OAAO,EAAE,CAAC;YACV,UAAU,EAAE,GAAG;YACf,UAAU,EAAE;WACb,EACD;YACE,cAAc,EAAE,EAAE;YAClB,eAAe,EAAE,QAAU;YAC3B,mBAAmB,EAAE;WACtB,EACD;YACE,gBAAgB,EAAE,QAAU;YAC5B,cAAc,EAAE;WACjB,EACD;YACE,gBAAgB,EAAE,QAAU;YAC5B,cAAc,EAAE;WACjB,CACF;UACD;QACF,KAAK,OAAO,CAAC,IAAI;QACjB,KAAK,OAAO,CAAC,cAAc;UACzB,IAAI,CAAC,oBAAoB,GAAG,IAAI,oBAAoB,CAClD,OAAO,EACP,QAAQ,EACR,IAAI,CAAC,kBAAkB,EACvB;YACE,OAAO,EAAE,CAAC;YACV,UAAU,EAAE,GAAG;YACf,UAAU,EAAE;WACb,EACD;YACE,cAAc,EAAE,EAAE;YAClB,eAAe,EAAE,OAAS;YAC1B,mBAAmB,EAAE;WACtB,EACD;YACE,gBAAgB,EAAE,OAAS;YAC3B,cAAc,EAAE;WACjB,EACD;YACE,gBAAgB,EAAE,OAAS;YAC3B,cAAc,EAAE;WACjB,CACF;UACD;QACF;UACE,IAAI,CAAC,oBAAoB,GAAG,IAAI,oBAAoB,CAClD,OAAO,EACP,QAAQ,EACR,IAAI,CAAC,kBAAkB,EACvB;YACE,OAAO,EAAE,CAAC;YACV,UAAU,EAAE,GAAG;YACf,UAAU,EAAE;WACb,EACD;YACE,cAAc,EAAE,GAAG;YACnB,eAAe,EAAE,MAAO;YACxB,mBAAmB,EAAE;WACtB,EACD;YACE,gBAAgB,EAAE,OAAS;YAC3B,cAAc,EAAE;WACjB,CACF;UACD;MAAM;IAEX;IAED,IAAI,CAAC,cAAc,GACjB,cAAc,KAAA,IAAA,IAAd,cAAc,KAAA,KAAA,CAAA,GAAd,cAAc,GACd,IAAI,qBAAqB,CACvB,OAAO,EACP,IAAI,cAAc,CAAC,OAAO,EAAE,IAAI,CAAC,kBAAkB,CAAC,EACpD,IAAI,WAAW,CAAC,IAAI,SAAS,CAAC;MAAE,MAAM,EAAE,EAAE;MAAE,SAAS,EAAE;IAAK,CAAE,CAAC,CAAC,CACjE;IAEH,IAAI,CAAC,eAAe,GAAG,eAAe,KAAA,IAAA,IAAf,eAAe,KAAA,KAAA,CAAA,GAAf,eAAe,GAAI,IAAI,eAAe,EAAE;IAE/D,IAAI,CAAC,wBAAwB,GAC3B,wBAAwB,KAAA,IAAA,IAAxB,wBAAwB,KAAA,KAAA,CAAA,GAAxB,wBAAwB,GACxB,IAAI,wBAAwB,CAC1B,OAAO,EACP,kBAA+B,EAC/B,IAAI,WAAW,CAAC,IAAI,SAAS,CAAC;MAAE,MAAM,EAAE,IAAI;MAAE,SAAS,EAAE;IAAK,CAAE,CAAC,CAAC,CACnE;IACH,IAAI,CAAC,aAAa,GAChB,aAAa,KAAA,IAAA,IAAb,aAAa,KAAA,KAAA,CAAA,GAAb,aAAa,GACb,IAAI,gCAAgC,CAClC,OAAO,EACP,IAAI,WAAW,CAAC,IAAI,SAAS,CAAC;MAAE,MAAM,EAAE,IAAI;MAAE,SAAS,EAAE;IAAK,CAAE,CAAC,CAAC,EAClE,IAAI,wBAAwB,CAC1B,OAAO,EACP,kBAAkB,EAClB,IAAI,WAAW,CAAC,IAAI,SAAS,CAAC;MAAE,MAAM,EAAE,IAAI;MAAE,SAAS,EAAE;IAAK,CAAE,CAAC,CAAC,CACnE,EACD,IAAI,aAAa,CAAC,OAAO,EAAE,IAAI,CAAC,kBAAkB,CAAC,CACpD;IAEH,MAAM,SAAS,GAAG,kBAAkB,CAAC,OAAO,CAAC;IAE7C;IACA,IAAI,kBAAkB,EAAE;MACtB,IAAI,CAAC,kBAAkB,GAAG,kBAAkB;KAC7C,MAAM;MACL,IAAI,CAAC,kBAAkB,GAAG,IAAI,+BAA+B,CAAC,CAC5D,IAAI,yBAAyB,CAC3B,OAAO,EACP,IAAI,mBAAmB,CACrB,OAAO,EACP,gEAAgE,SAAS,OAAO,EAChF,SAAS,EACT,CAAC,CACF,EACD,IAAI,WAAW,CAAC,IAAI,SAAS,CAAC;QAAE,MAAM,EAAE,GAAG;QAAE,SAAS,EAAE;MAAK,CAAE,CAAC,CAAC,CAClE,EACD,IAAI,wBAAwB,CAAC,OAAO,CAAC,CACtC,CAAC;IACH;IAED,IAAI,kBAAkB,EAAE;MACtB,IAAI,CAAC,kBAAkB,GAAG,kBAAkB;KAC7C,MAAM;MACL,IAAI,CAAC,kBAAkB,GAAG,IAAI,+BAA+B,CAAC,CAC5D,IAAI,yBAAyB,CAC3B,OAAO,EACP,IAAI,mBAAmB,CACrB,OAAO,EACP,gEAAgE,SAAS,OAAO,EAChF,SAAS,EACT,CAAC,CACF,EACD,IAAI,WAAW,CAAC,IAAI,SAAS,CAAC;QAAE,MAAM,EAAE,GAAG;QAAE,SAAS,EAAE;MAAK,CAAE,CAAC,CAAC,CAClE,EACD,IAAI,wBAAwB,CAAC,OAAO,EAAE,IAAI,CAAC,cAAc,CAAC,CAC3D,CAAC;IACH;IAED,IAAI,wBAA2C;IAC/C,IAAI,IAAI,CAAC,QAAQ,YAAY,eAAe,EAAE;MAC5C,wBAAwB,GAAG,IAAI,uBAAuB,CACpD,OAAO,EACP,IAAI,uBAAuB,CAAC,IAAI,CAAC,QAAQ,CAAC,EAC1C,IAAI,sBAAsB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAC1C;KACF,MAAM;MACL,wBAAwB,GAAG,IAAI,yBAAyB,CAAC,uBAAuB,CAAC;IAClF;IAED,IAAI,CAAC,gBAAgB,GACnB,gBAAgB,KAAA,IAAA,IAAhB,gBAAgB,KAAA,KAAA,CAAA,GAAhB,gBAAgB,GAChB,IAAI,yBAAyB,CAC3B,OAAO,EACP,wBAAwB,EACxB,IAAI,WAAW,CACb,IAAI,SAAS,CAAC;MAAE,MAAM,EAAE,EAAE;MAAE,SAAS,EAAE;IAAK,CAAE,CAAC,CAChD,CACF;IACH,IAAI,CAAC,iBAAiB,GACpB,iBAAiB,KAAA,IAAA,IAAjB,iBAAiB,KAAA,KAAA,CAAA,GAAjB,iBAAiB,GAAI,IAAI,0BAA0B,EAAE;IACvD,IAAI,CAAC,iBAAiB,GACpB,iBAAiB,KAAA,IAAA,IAAjB,iBAAiB,KAAA,KAAA,CAAA,GAAjB,iBAAiB,GAAI,IAAI,0BAA0B,EAAE;IACvD,IAAI,CAAC,yBAAyB,GAC5B,yBAAyB,KAAA,IAAA,IAAzB,yBAAyB,KAAA,KAAA,CAAA,GAAzB,yBAAyB,GAAI,IAAI,kCAAkC,EAAE;IAEvE,IAAI,CAAC,kBAAkB,GACrB,kBAAkB,KAAA,IAAA,IAAlB,kBAAkB,KAAA,KAAA,CAAA,GAAlB,kBAAkB,GAClB,IAAI,kBAAkB,CAAC,IAAI,CAAC,kBAAkB,EAAE,IAAI,CAAC,OAAO,CAAC;IAE/D,IAAI,OAAO,IAAI,OAAO,CAAC,QAAQ,IAAI,OAAO,IAAI,OAAO,CAAC,gBAAgB,EAAE;MACtE,IAAI,CAAC,iBAAiB,GACpB,uBAAuB,KAAA,IAAA,IAAvB,uBAAuB,KAAA,KAAA,CAAA,GAAvB,uBAAuB,GACvB,IAAI,uBAAuB,CAAC,OAAO,EAAE,IAAI,CAAC,kBAAkB,CAAC;IAChE;IACD,IACE,OAAO,IAAI,OAAO,CAAC,YAAY,IAC/B,OAAO,IAAI,OAAO,CAAC,gBAAgB,IACnC,OAAO,IAAI,OAAO,CAAC,eAAe,EAClC;MACA,IAAI,CAAC,iBAAiB,GACpB,uBAAuB,KAAA,IAAA,IAAvB,uBAAuB,KAAA,KAAA,CAAA,GAAvB,uBAAuB,GACvB,IAAI,uBAAuB,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC;IACtD;IACD,IAAI,sBAAsB,EAAE;MAC1B,IAAI,CAAC,sBAAsB,GAAG,sBAAsB;KACrD,MAAM,IAAI,IAAI,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,EAAE;MAC1C,IAAI,CAAC,sBAAsB,GAAG,IAAI,sBAAsB,CACtD,IAAI,CAAC,OAAO,EACZ,IAAI,CAAC,kBAAkB,EACvB,IAAI,WAAW,CAAC,IAAI,SAAS,CAAC;QAAE,MAAM,EAAE,KAAK;QAAE,SAAS,EAAE;MAAK,CAAE,CAAC,CAAC,CACpE;IACF;IAED;IACA;IACA,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ,CAC1B,IAAI,CAAC,kBAAkB,EACvB,IAAI,CAAC,cAAc,EACnB,IAAI,CAAC,eAAe,EACpB,IAAI,CAAC,iBAAiB,EACtB,IAAI,CAAC,aAAa,EAClB,IAAI,CAAC,OAAO,EACZ,IAAI,CAAC,wBAAwB,EAC7B,IAAI,CAAC,sBAAsB,CAC5B;IAED,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ,CAC1B,IAAI,CAAC,kBAAkB,EACvB,IAAI,CAAC,cAAc,EACnB,IAAI,CAAC,oBAAoB,EACzB,IAAI,CAAC,aAAa,EAClB,IAAI,CAAC,OAAO,EACZ,IAAI,CAAC,wBAAwB,EAC7B,IAAI,CAAC,sBAAsB,CAC5B;IAED,IAAI,CAAC,WAAW,GAAG,IAAI,WAAW,CAChC,IAAI,CAAC,kBAAkB,EACvB,IAAI,CAAC,cAAc,EACnB,IAAI,CAAC,kBAAkB,EACvB,IAAI,CAAC,cAAc,EACnB,IAAI,CAAC,oBAAoB,EACzB,IAAI,CAAC,aAAa,EAClB,IAAI,CAAC,OAAO,EACZ,IAAI,CAAC,wBAAwB,EAC7B,IAAI,CAAC,sBAAsB,CAC5B;EACH;EAEO,MAAM,YAAY,CACvB,aAA6B,EAC7B,aAA6B,EAC7B,QAAkB,EAClB,gBAAkC,EAClC,iBAAqC,EAGpC;IAAA,IAFD,aAAA,uEAA4C,+BAA+B,CACzE,IAAI,CAAC,OAAO,CACb;IAED,IACE,aAAa,CAAC,QAAQ,CAAC,OAAO,CAAC,WAAW,CAAC,aAAa,CAAC,QAAQ,CAAC,OAAO,CAAC,EAC1E;MACA,CAAC,aAAa,EAAE,aAAa,CAAC,GAAG,CAAC,aAAa,EAAE,aAAa,CAAC;IAChE;IAED,IAAI,mBAAmB,GAAG,IAAI,CAAC,qBAAqB,CAClD,QAAQ,EACR,QAAQ,CAAC,IAAI,CAAC,YAAY,EAC1B,IAAI,CACL;IACD;IACA,IAAI,UAAmB;IACvB,IAAI,QAAQ,CAAC,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,SAAS,EAAE;MAClD,UAAU,GAAG,IAAI;KAClB,MAAM,IAAI,QAAQ,CAAC,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,SAAS,EAAE;MACzD,UAAU,GAAG,KAAK;KACnB,MAAM;MACL,UAAU,GAAG,IAAI,QAAQ,CACvB,aAAa,CAAC,QAAQ,EACtB,aAAa,CAAC,QAAQ,CACvB,CAAC,WAAW,CAAC,mBAAmB,CAAC;MAClC,IAAI,CAAC,UAAU,EAAE,mBAAmB,GAAG,mBAAmB,CAAC,MAAM,EAAE;IACpE;IAED,MAAM,CAAC,YAAY,EAAE,aAAa,CAAC,GAAG,UAAU,GAC5C,CAAC,aAAa,EAAE,aAAa,CAAC,GAC9B,CAAC,aAAa,EAAE,aAAa,CAAC;IAElC,IAAI,YAAY,GAAG,mBAAmB;IACtC,IAAI,kBAAkB,GAAG,QAAQ,CAAC,IAAI;IACtC,IAAI,YAAY,GAAa,UAAU,GACnC,QAAQ,CAAC,IAAI,CAAC,WAAW,GACzB,QAAQ,CAAC,IAAI,CAAC,WAAW;IAC7B,IAAI,IAAI,GAAqB,IAAI;IACjC,IAAI,aAAa,GAAG,KAAK;IACzB,IAAI,CAAC,GAAG,CAAC;IACT;IACA,OAAO,CAAC,aAAa,EAAE;MACrB,CAAC,EAAE;MACH,IAAI,CAAC,GAAG,gBAAgB,CAAC,aAAa,EAAE;QACtC,GAAG,CAAC,IAAI,CAAC,yBAAyB,CAAC;QACnC,OAAO;UACL,MAAM,EAAE,iBAAiB,CAAC,cAAc;UACxC,KAAK,EAAE;SACR;MACF;MAED,MAAM,YAAY,GAAG,sBAAsB,CACzC,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,aAAa,CACd;MACD,IAAI,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;QAC3B,GAAG,CAAC,IAAI,CAAC,kCAAkC,CAAC;QAC5C,OAAO;UACL,MAAM,EAAE,iBAAiB,CAAC;SAC3B;MACF;MACD,IAAI,GAAG,MAAM,IAAI,CAAC,KAAK,CACrB,YAAY,EACZ,aAAa,CAAC,QAAQ,EACtB,SAAS,CAAC,WAAW,EACrB,SAAS,EACT;QACE,GAAG,+BAA+B,CAAC,IAAI,CAAC,OAAO,CAAC;QAChD,GAAG,aAAa;QAChB;QACA;QACA,SAAS,EAAE,CAAC,QAAQ,CAAC,EAAE,EAAE,QAAQ,CAAC,EAAE;OACrC,CACF;MACD,IAAI,CAAC,IAAI,EAAE;QACT,GAAG,CAAC,IAAI,CAAC,kCAAkC,CAAC;QAC5C,OAAO;UACL,MAAM,EAAE,iBAAiB,CAAC,cAAc;UACxC,KAAK,EAAE;SACR;MACF;MAED,MAAM,mBAAmB,GAAG,YAAY,CAAC,QAAQ,CAC/C,IAAI,CAAC,KAAM,CAAC,WAAW,CACxB;MACD,MAAM,oBAAoB,GAAG,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,KAAM,CAAC,YAAY,CAAC;MACxE,MAAM,QAAQ,GAAG,mBAAmB,CAAC,MAAM,CAAC,oBAAoB,CAAC;MAEjE,IAAI,qBAAqB;MACzB,IAAI,CAAC,KAAK,CAAC,OAAO,CAAE,KAAK,IAAI;QAC3B,IAAI,KAAK,CAAC,QAAQ,IAAI,QAAQ,CAAC,EAAE,EAAE;UACjC,MAAM,OAAO,GAAG,KAA8B;UAC9C,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,CAAC,KAAI;YACtC,IACE,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,IACxC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,IACxC,IAAI,CAAC,GAAG,IAAI,QAAQ,CAAC,IAAI,CAAC,GAAG,EAC7B;cACA,qBAAqB,GAAG,IAAI,CAAC,MAAM,CACjC,OAAO,CAAC,qBAAqB,CAAC,CAAC,CAAE,CAAC,QAAQ,EAAE,CAC7C;cACD,YAAY,GAAG,IAAI,CAAC,qBAAqB,CACvC,QAAQ,EACR,IAAI,CAAC,MAAM,CAAC,qBAAsB,CAAC,QAAQ,EAAE,CAAC,EAC9C,UAAU,CACX;YACF;UACH,CAAC,CAAC;QACH;MACH,CAAC,CAAC;MACF,IAAI,CAAC,qBAAqB,EAAE;QAC1B,YAAY,GAAG,mBAAmB;MACnC;MACD,aAAa,GACX,QAAQ,CAAC,OAAO,CAAC,YAAY,CAAC,IAC9B,IAAI,CAAC,aAAa,CAChB,QAAQ,CAAC,UAAU,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CACrD,CAAC,QAAQ,CAAC,gBAAgB,CAAC,mBAAmB,CAAC;MAElD,IAAI,aAAa,IAAI,qBAAqB,EAAE;QAC1C,kBAAkB,GAAG,IAAI,IAAI,CAC3B,QAAQ,CAAC,IAAI,CAAC,MAAM,EACpB,QAAQ,CAAC,IAAI,CAAC,MAAM,EACpB,QAAQ,CAAC,IAAI,CAAC,GAAG,EACjB,qBAAqB,EACrB,QAAQ,CAAC,IAAI,CAAC,SAAS,EACvB,QAAQ,CAAC,kBAAkB,CAAC,qBAAqB,CAAC,EAClD,QAAQ,CAAC,IAAI,CAAC,gBAAgB,CAC/B;MACF;MACD,YAAY,GAAG,IAAI,CAAC,KAAM,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,KAAM,CAAC,WAAW,CAAC;MAEvE,GAAG,CAAC,IAAI,CACN;QACE,YAAY,EAAE,YAAY,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC;QACjD,YAAY,EAAE,YAAY,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC;QACjD,QAAQ,EAAE,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC;QACzC,mBAAmB,EAAE,mBAAmB,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC;QAC/D,oBAAoB,EAAE,oBAAoB,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC;QACjE,mBAAmB,EAAE,gBAAgB,CAAC,mBAAmB,CAAC,OAAO,CAAC,EAAE,CAAC;QACrE,UAAU,EAAE,CAAC,CAAC,QAAQ;OACvB,EACD,mCAAmC,CACpC;MAED,IAAI,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;QAC3B,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC;QAC7B,OAAO;UACL,MAAM,EAAE,iBAAiB,CAAC,cAAc;UACxC,KAAK,EAAE;SACR;MACF;IACF;IAED,IAAI,CAAC,IAAI,EAAE;MACT,OAAO;QACL,MAAM,EAAE,iBAAiB,CAAC,cAAc;QACxC,KAAK,EAAE;OACR;IACF;IACD,IAAI,gBAA8C;IAClD,IAAI,iBAAiB,EAAE;MACrB,gBAAgB,GAAG,MAAM,IAAI,CAAC,+BAA+B,CAC3D,IAAI,CAAC,KAAK,EACV,iBAAiB,EACjB;QACE,qBAAqB,EAAE,YAAY;QACnC,sBAAsB,EAAE,aAAa;QACrC,oBAAoB,EAAE;OACvB,CACF;IACF;IAED,OAAO;MACL,MAAM,EAAE,iBAAiB,CAAC,OAAO;MACjC,MAAM,EAAE;QAAE,GAAG,IAAI;QAAE,gBAAgB;QAAE,YAAY;QAAE;MAAkB;KACtE;EACH;EAEA;;AAEG;EACI,MAAM,KAAK,CAChB,MAAsB,EACtB,aAAuB,EACvB,SAAoB,EACpB,UAAwB,EAC6B;IAAA,IAArD,oBAAA,uEAAmD,CAAA,CAAE;;IAErD,MAAM,CAAC,SAAS,CACd,yBAAyB,IAAI,CAAC,OAAO,EAAE,EACvC,CAAC,EACD,gBAAgB,CAAC,KAAK,CACvB;IAED;IACA;IACA,MAAM,WAAW,GACf,CAAA,EAAA,GAAA,oBAAoB,CAAC,WAAW,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAI,IAAI,CAAC,qBAAqB,EAAE;IAElE,MAAM,aAAa,GAAsB,CAAC,CAAC,KAAK,CAC9C,CAAA,CAAE,EACF,+BAA+B,CAAC,IAAI,CAAC,OAAO,CAAC,EAC7C,oBAAoB,EACpB;MAAE;IAAW,CAAE,CAChB;IAED,MAAM;MAAE,UAAU;MAAE;IAAW,CAAE,GAAG,IAAI,CAAC,mCAAmC,CAAC,SAAS,EAAE,MAAM,EAAE,aAAa,CAAC;IAE9G,MAAM,OAAO,GAAG,UAAU,CAAC,OAAO;IAClC,MAAM,QAAQ,GAAG,WAAW,CAAC,OAAO;IAEpC;IACA;IACA;IACA,MAAM,CAAC,QAAQ,EAAE,OAAO,CAAC,GAAG,IAAI,CAAC,qBAAqB,CACpD,MAAM,EACN,aAAa,CACd;IAED,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,cAAc,EAAE;IAE/C,MAAM,UAAU,GAAG,aAAa,CAAC,OAAO;IAExC,MAAM,aAAa,GAA+B,EAAE;IAEpD,MAAM,CAAC,UAAU,EAAE,kBAAkB,CAAC,GAAG,MAAM,IAAI,CAAC,YAAY,CAC9D,WAAW,EACX,MAAM,CAAC,QAAQ,CAAC,OAAO,EACvB,UAAU,CACX;IAED;IACA;IACA,MAAM,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC,MAAM,EAAE,CAAC;IAEvE,MAAM,oBAAoB,GAAG,SAAS,CAAC,MAAM,IAAI,CAAC;IAClD,MAAM,mBAAmB,GAAG,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC;IAC3D,MAAM,mBAAmB,GAAG,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC;IAC3D,MAAM,kBAAkB,GAAG,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC;IAC9D,MAAM,wBAAwB,GAAG,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAK,oBAAoB,IAAI,kBAAmB;IACnH,MAAM,oBAAoB,GAAG,CAAC,OAAO,CAAC,OAAO,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,IAClF,SAAS,KAAK,SAAS,CAAC,WAAW;IAErC;IACA,IAAI,mBAAmB,IAAI,oBAAoB,EAAE;MAC/C,GAAG,CAAC,IAAI,CAAC;QAAE,SAAS;QAAE;MAAS,CAAE,EAAE,mBAAmB,CAAC;MACvD,aAAa,CAAC,IAAI,CAChB,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAC/B,OAAO,EACP,QAAQ,EACR,OAAO,EACP,QAAQ,EACR,UAAU,EACV,SAAS,EACT,aAAa,EACb,UAAU,CACX,CACF;IACF;IAED;IACA,IAAI,kBAAkB,KAAK,mBAAmB,IAAI,oBAAoB,CAAC,EAAE;MACvE,GAAG,CAAC,IAAI,CAAC;QAAE,SAAS;QAAE;MAAS,CAAE,EAAE,mBAAmB,CAAC;MACvD,aAAa,CAAC,IAAI,CAChB,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAC/B,OAAO,EACP,QAAQ,EACR,OAAO,EACP,QAAQ,EACR,UAAU,EACV,SAAS,EACT,aAAa,EACb,SAAS,EACT,WAAW,CACZ,CACF;IACF;IAED;IACA;IACA;IACA,IAAI,wBAAwB,IAAI,oBAAoB,EAAE;MACpD,GAAG,CAAC,IAAI,CAAC;QAAE,SAAS;QAAE;MAAS,CAAE,EAAE,4BAA4B,CAAC;MAChE,aAAa,CAAC,IAAI,CAChB,IAAI,CAAC,WAAW,CAAC,mBAAmB,CAClC,OAAO,EACP,QAAQ,EACR,OAAO,EACP,QAAQ,EACR,UAAU,EACV,SAAS,EACT,aAAa,EACb,kBAAkB,CACnB,CACF;IACF;IAED,MAAM,+BAA+B,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC;IAExE;IACA;IACA;IACA,IAAI,wBAAwB,GAA0B,EAAE;IACxD,IAAI,iBAAiB,GAAwC,EAAE;IAC/D,KAAK,MAAM;MACT,qBAAqB;MACrB;IAAc,CACf,IAAI,+BAA+B,EAAE;MACpC,wBAAwB,GAAG,CACzB,GAAG,wBAAwB,EAC3B,GAAG,qBAAqB,CACzB;MACD,IAAI,cAAc,EAAE;QAClB,iBAAiB,GAAG,CAAC,GAAG,iBAAiB,EAAE,cAAc,CAAC;MAC3D;IACF;IAED,IAAI,wBAAwB,CAAC,MAAM,IAAI,CAAC,EAAE;MACxC,GAAG,CAAC,IAAI,CAAC;QAAE;MAAwB,CAAE,EAAE,0BAA0B,CAAC;MAClE,OAAO,IAAI;IACZ;IAED;IACA,MAAM,cAAc,GAAG,IAAI,CAAC,GAAG,EAAE;IAEjC,MAAM,YAAY,GAAG,MAAM,gBAAgB,CACzC,MAAM,EACN,QAAQ,EACR,wBAAwB,EACxB,SAAS,EACT,IAAI,CAAC,OAAO,EACZ,aAAa,EACb,UAAU,CACX;IAED,IAAI,CAAC,YAAY,EAAE;MACjB,OAAO,IAAI;IACZ;IAED,MAAM;MACJ,KAAK;MACL,gBAAgB;MAChB,gBAAgB;MAChB,MAAM,EAAE,YAAY;MACpB,0BAA0B;MAC1B;IAAmB,CACpB,GAAG,YAAY;IAEhB;IACA,MAAM,KAAK,GAAG,UAAU,CACtB,UAAU,EACV,WAAW,EACX,SAAS,EACT,YAAY,CACb;IAED,IAAI,gBAA8C;IAElD;IACA;IACA,IAAI,UAAU,EAAE;MACd,gBAAgB,GAAG,yBAAyB,CAC1C,KAAK,EACL,UAAU,EACV,IAAI,CAAC,OAAO,CACb;IACF;IAED,MAAM,CAAC,SAAS,CACd,mBAAmB,EACnB,IAAI,CAAC,GAAG,EAAE,GAAG,cAAc,EAC3B,gBAAgB,CAAC,YAAY,CAC9B;IAED,MAAM,CAAC,SAAS,CACd,qBAAqB,IAAI,CAAC,OAAO,EAAE,EACnC,CAAC,EACD,gBAAgB,CAAC,KAAK,CACvB;IAED,IAAI,CAAC,wBAAwB,CAAC,YAAY,EAAE,iBAAiB,CAAC;IAE9D,MAAM,SAAS,GAAc;MAC3B,KAAK;MACL,gBAAgB;MAChB,gBAAgB;MAChB,0BAA0B;MAC1B,mBAAmB;MACnB,WAAW;MACX,KAAK,EAAE,YAAY;MACnB,KAAK;MACL,gBAAgB;MAChB,WAAW,EAAE,SAAS,CAAC,IAAI,CAAC,MAAM,WAAW;KAC9C;IAED,IACE,UAAU,IACV,UAAU,CAAC,QAAQ,IACnB,gBAAgB,IAChB,gBAAgB,CAAC,QAAQ,EACzB;MACA,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;QACnB,MAAM,IAAI,KAAK,CAAC,4BAA4B,CAAC;MAC9C;MACD,GAAG,CAAC,IAAI,CAAC;QAAE,UAAU;QAAE;MAAgB,CAAE,EAAE,qBAAqB,CAAC;MACjE,MAAM,WAAW,GAAG,UAAU,CAAC,QAAQ,CAAC,WAAW;MACnD,MAAM,cAAc,GAAG,IAAI,CAAC,GAAG,EAAE;MACjC,MAAM,uBAAuB,GAAG,MAAM,IAAI,CAAC,SAAS,CAAC,QAAQ,CAC3D,WAAW,EACX,UAAU,EACV,SAAS,EACT,MAAM;MACN;MACA;MACA,cAAc,CAAC,aAAa,CAAC,aAAa,EAAE,KAAK,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,EACtE,IAAI,CAAC,iBAAiB,GAClB,MAAM,IAAI,CAAC,iBAAkB,CAAC,UAAU,EAAE,GAC1C,SAAS,EACb;QAAE;MAAW,CAAE,CAChB;MACD,MAAM,CAAC,SAAS,CACd,qBAAqB,EACrB,IAAI,CAAC,GAAG,EAAE,GAAG,cAAc,EAC3B,gBAAgB,CAAC,YAAY,CAC9B;MACD,OAAO,uBAAuB;IAC/B;IAED,OAAO,SAAS;EAClB;EAEQ,mCAAmC,CAAC,SAAoB,EAAE,MAAsB,EAAE,aAAuB,EAAA;IAC/G,IAAI,SAAS,IAAI,SAAS,CAAC,WAAW,EAAE;MACtC,OAAO;QACL,UAAU,EAAE,MAAM,CAAC,QAAQ;QAC3B,WAAW,EAAE;OACd;KACF,MAAM;MACL,OAAO;QACL,UAAU,EAAE,aAAa;QACzB,WAAW,EAAE,MAAM,CAAC;OACrB;IACF;EACH;EAEQ,MAAM,cAAc,GAAA;IAC1B;IACA,MAAM,kBAAkB,GAAG,IAAI,CAAC,GAAG,EAAE;IAErC;IACA,MAAM;MAAE;IAAW,CAAE,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,WAAW,EAAE;IAEjE,MAAM,CAAC,SAAS,CACd,cAAc,EACd,IAAI,CAAC,GAAG,EAAE,GAAG,kBAAkB,EAC/B,gBAAgB,CAAC,YAAY,CAC9B;IAED,OAAO,WAAW;EACpB;EAEQ,MAAM,YAAY,CACxB,WAAsB,EACtB,WAAkB,EAClB,UAAiB,EAAA;IAKjB,MAAM,cAAc,GAAG,IAAI,CAAC,GAAG,EAAE;IAEjC,MAAM,iBAAiB,GAAG,IAAI,CAAC,iBAAiB,CAAC,aAAa,CAAC;MAC7D,OAAO,EAAE,IAAI,CAAC,OAAO;MACrB,WAAW;MACX,cAAc,EAAE,IAAI,CAAC,cAAc;MACnC,WAAW;MACX,UAAU;MACV,cAAc,EAAE,IAAI,CAAC,cAAc;MACnC,iBAAiB,EAAE,IAAI,CAAC;KACzB,CAAC;IAEF,MAAM,yBAAyB,GAAG,IAAI,CAAC,yBAAyB,CAAC,aAAa,CAAC;MAC7E,OAAO,EAAE,IAAI,CAAC,OAAO;MACrB,WAAW;MACX,cAAc,EAAE,IAAI,CAAC,cAAc;MACnC,WAAW;MACX,UAAU;MACV,cAAc,EAAE,IAAI,CAAC;KACtB,CAAC;IAEF,MAAM,CAAC,UAAU,EAAE,kBAAkB,CAAC,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,CACzD,iBAAiB,EACjB,yBAAyB,CAC1B,CAAC;IAEF,MAAM,CAAC,SAAS,CACd,kBAAkB,EAClB,IAAI,CAAC,GAAG,EAAE,GAAG,cAAc,EAC3B,gBAAgB,CAAC,YAAY,CAC9B;IAED,OAAO,CAAC,UAAU,EAAE,kBAAkB,CAAC;EACzC;EAEA;EACA;EACA;EACQ,qBAAqB,CAC3B,MAAsB,EACtB,aAAgC,EAAA;IAEhC,MAAM;MAAE;IAAmB,CAAE,GAAG,aAAa;IAC7C,MAAM,QAAQ,GAAG,EAAE;IACnB,MAAM,OAAO,GAAG,EAAE;IAElB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,GAAG,GAAG,mBAAmB,EAAE,CAAC,EAAE,EAAE;MACnD,QAAQ,CAAC,IAAI,CAAC,CAAC,GAAG,mBAAmB,CAAC;MACtC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,QAAQ,CAAC,CAAC,GAAG,mBAAmB,EAAE,GAAG,CAAC,CAAC,CAAC;IAC1E;IAED,OAAO,CAAC,QAAQ,EAAE,OAAO,CAAC;EAC5B;EAEQ,MAAM,+BAA+B,CAC3C,KAA2C,EAC3C,iBAAoC,EACpC,oBAA0C,EAAA;IAE1C,MAAM;MACJ,WAAW,EAAE;QAAE,SAAS;QAAE,iBAAiB;QAAE,QAAQ;QAAE;MAAgB,CAAE;MACzE,mBAAmB,EAAE;IAAkB,CACxC,GAAG,iBAAiB;IAErB,MAAM,oBAAoB,GAAG,oBAAoB,CAAC,oBAAoB;IACtE,MAAM,mBAAmB,GACvB,oBAAoB,CAAC,qBAAqB,CAAC,QAAQ,CAAC,KAAK,CAAC,WAAW,CAAC;IACxE,MAAM,oBAAoB,GACxB,oBAAoB,CAAC,sBAAsB,CAAC,GAAG,CAAC,KAAK,CAAC,YAAY,CAAC;IACrE,MAAM,aAAa,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,eAAe,CACjE,mBAAmB,EACnB,oBAAoB,CACrB;IACD,MAAM,UAAU,GAAG,mBAAmB,CAAC,QAAQ,CAAC,OAAO,CAAC,WAAW,CACjE,oBAAoB,CAAC,QAAQ,CAAC,OAAO,CACtC;IACD,OAAO;MACL,GAAG,UAAU,CAAC,wBAAwB,CACpC,KAAK,EACL;QACE,SAAS;QACT,iBAAiB;QACjB,2BAA2B,EAAE,QAAQ;QACrC;OACD,EACD,QAAQ,CAAC,WAAW,CAAC;QACnB,IAAI,EAAE,oBAAoB,CAAC,IAAI;QAC/B,SAAS,EAAE,oBAAoB,CAAC,SAAS;QACzC,SAAS,EAAE,oBAAoB,CAAC,SAAS;QACzC,OAAO,EAAE,UAAU,GACf,mBAAmB,CAAC,QAAQ,CAAC,QAAQ,EAAE,GACvC,oBAAoB,CAAC,QAAQ,CAAC,QAAQ,EAAE;QAC5C,OAAO,EAAE,UAAU,GACf,oBAAoB,CAAC,QAAQ,CAAC,QAAQ,EAAE,GACxC,mBAAmB,CAAC,QAAQ,CAAC,QAAQ,EAAE;QAC3C,gBAAgB,EAAE;OACnB,CAAC,EACF,kBAAkB,EAClB,aAAa,CAAC,eAAe,EAC7B,aAAa,CAAC,gBAAgB,CAC/B;MACD,EAAE,EAAE,wBAAwB,CAAC,IAAI,CAAC,OAAO;KAC1C;EACH;EAEQ,wBAAwB,CAC9B,YAKC,EACD,mBAAwD,EAAA;IAExD,MAAM,iBAAiB,GAAG,IAAI,GAAG,EAAU;IAC3C,MAAM;MAAE,MAAM,EAAE;IAAY,CAAE,GAAG,YAAY;IAC7C,CAAC,CAAC,YAAY,CAAC,CACZ,OAAO,CAAE,WAAW,IAAI;MACvB,MAAM;QAAE;MAAa,CAAE,GAAG,WAAW;MACrC,OAAO,aAAa;IACtB,CAAC,CAAC,CACD,OAAO,CAAE,OAAe,IAAI;MAC3B,iBAAiB,CAAC,GAAG,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;IAC9C,CAAC,CAAC;IAEJ,KAAK,MAAM,gBAAgB,IAAI,mBAAmB,EAAE;MAClD,MAAM;QAAE;MAAQ,CAAE,GAAG,gBAAgB;MACrC,CAAC,CAAC,KAAK,CACL,gBAAgB,CAAC,UAAU,EAC3B,CAAC,KAAe,EAAE,aAAqB,KAAI;QACzC,MAAM,QAAQ,GACZ,CAAC,CAAC,aAAa,CAAC,KAAK,EAAG,IAAI,IAC1B,iBAAiB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,WAAW,EAAE,CAAC,CAC7C,GAAG,CAAC;QACP,MAAM,CAAC,SAAS,CACd,CAAC,CAAC,UAAU,CAAC,GAAG,QAAQ,GAAG,aAAa,EAAE,CAAC,EAC3C,QAAQ,EACR,gBAAgB,CAAC,KAAK,CACvB;MACH,CAAC,CACF;IACF;IAED,IAAI,UAAU,GAAG,KAAK;IACtB,IAAI,UAAU,GAAG,KAAK;IACtB,IAAI,aAAa,GAAG,KAAK;IACzB,KAAK,MAAM,WAAW,IAAI,YAAY,EAAE;MACtC,IAAI,WAAW,CAAC,QAAQ,IAAI,QAAQ,CAAC,EAAE,EAAE;QACvC,UAAU,GAAG,IAAI;MAClB;MACD,IAAI,WAAW,CAAC,QAAQ,IAAI,QAAQ,CAAC,EAAE,EAAE;QACvC,UAAU,GAAG,IAAI;MAClB;MACD,IAAI,WAAW,CAAC,QAAQ,IAAI,QAAQ,CAAC,KAAK,EAAE;QAC1C,aAAa,GAAG,IAAI;MACrB;IACF;IAED,IAAI,aAAa,KAAK,UAAU,IAAI,UAAU,CAAC,EAAE;MAC/C,IAAI,UAAU,IAAI,UAAU,EAAE;QAC5B,MAAM,CAAC,SAAS,CACd,2BAA2B,EAC3B,CAAC,EACD,gBAAgB,CAAC,KAAK,CACvB;QACD,MAAM,CAAC,SAAS,CACd,oCAAoC,IAAI,CAAC,OAAO,EAAE,EAClD,CAAC,EACD,gBAAgB,CAAC,KAAK,CACvB;OACF,MAAM,IAAI,UAAU,EAAE;QACrB,MAAM,CAAC,SAAS,CAAC,sBAAsB,EAAE,CAAC,EAAE,gBAAgB,CAAC,KAAK,CAAC;QACnE,MAAM,CAAC,SAAS,CACd,+BAA+B,IAAI,CAAC,OAAO,EAAE,EAC7C,CAAC,EACD,gBAAgB,CAAC,KAAK,CACvB;OACF,MAAM,IAAI,UAAU,EAAE;QACrB,MAAM,CAAC,SAAS,CAAC,sBAAsB,EAAE,CAAC,EAAE,gBAAgB,CAAC,KAAK,CAAC;QACnE,MAAM,CAAC,SAAS,CACd,+BAA+B,IAAI,CAAC,OAAO,EAAE,EAC7C,CAAC,EACD,gBAAgB,CAAC,KAAK,CACvB;MACF;KACF,MAAM,IAAI,UAAU,IAAI,UAAU,EAAE;MACnC,MAAM,CAAC,SAAS,CAAC,mBAAmB,EAAE,CAAC,EAAE,gBAAgB,CAAC,KAAK,CAAC;MAChE,MAAM,CAAC,SAAS,CACd,4BAA4B,IAAI,CAAC,OAAO,EAAE,EAC1C,CAAC,EACD,gBAAgB,CAAC,KAAK,CACvB;KACF,MAAM,IAAI,aAAa,EAAE;MACxB,IAAI,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE;QAC3B,MAAM,CAAC,SAAS,CAAC,iBAAiB,EAAE,CAAC,EAAE,gBAAgB,CAAC,KAAK,CAAC;QAC9D,MAAM,CAAC,SAAS,CACd,0BAA0B,IAAI,CAAC,OAAO,EAAE,EACxC,CAAC,EACD,gBAAgB,CAAC,KAAK,CACvB;OACF,MAAM;QACL,MAAM,CAAC,SAAS,CAAC,YAAY,EAAE,CAAC,EAAE,gBAAgB,CAAC,KAAK,CAAC;QACzD,MAAM,CAAC,SAAS,CACd,qBAAqB,IAAI,CAAC,OAAO,EAAE,EACnC,CAAC,EACD,gBAAgB,CAAC,KAAK,CACvB;MACF;KACF,MAAM,IAAI,UAAU,EAAE;MACrB,IAAI,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE;QAC3B,MAAM,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC,EAAE,gBAAgB,CAAC,KAAK,CAAC;QAC3D,MAAM,CAAC,SAAS,CACd,uBAAuB,IAAI,CAAC,OAAO,EAAE,EACrC,CAAC,EACD,gBAAgB,CAAC,KAAK,CACvB;OACF,MAAM;QACL,MAAM,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC,EAAE,gBAAgB,CAAC,KAAK,CAAC;QACtD,MAAM,CAAC,SAAS,CACd,kBAAkB,IAAI,CAAC,OAAO,EAAE,EAChC,CAAC,EACD,gBAAgB,CAAC,KAAK,CACvB;MACF;KACF,MAAM,IAAI,UAAU,EAAE;MACrB,IAAI,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE;QAC3B,MAAM,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC,EAAE,gBAAgB,CAAC,KAAK,CAAC;QAC3D,MAAM,CAAC,SAAS,CACd,uBAAuB,IAAI,CAAC,OAAO,EAAE,EACrC,CAAC,EACD,gBAAgB,CAAC,KAAK,CACvB;OACF,MAAM;QACL,MAAM,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC,EAAE,gBAAgB,CAAC,KAAK,CAAC;QACtD,MAAM,CAAC,SAAS,CACd,kBAAkB,IAAI,CAAC,OAAO,EAAE,EAChC,CAAC,EACD,gBAAgB,CAAC,KAAK,CACvB;MACF;IACF;EACH;EAEQ,qBAAqB,CAC3B,QAAkB,EAClB,YAAkB,EAClB,UAAmB,EAAA;IAEnB,MAAM,iBAAiB,GAAG,QAAQ,CAAC,kBAAkB,CAAC,QAAQ,CAAC,SAAS,CAAC;IACzE,MAAM,iBAAiB,GAAG,QAAQ,CAAC,kBAAkB,CAAC,QAAQ,CAAC,SAAS,CAAC;IAEzE;IACA;IACA,IACE,IAAI,CAAC,WAAW,CAAC,YAAY,EAAE,iBAAiB,CAAC,IACjD,IAAI,CAAC,QAAQ,CAAC,YAAY,EAAE,iBAAiB,CAAC,EAC9C;MACA,OAAO,IAAI,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC;IAC1B;IAED,MAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;IACnD,IAAI,YAAY,GAAG,IAAI,QAAQ,CAC7B,aAAa,CAAC,eAAe,CAC3B,YAAY,EACZ,iBAAiB,EACjB,SAAS,EACT,IAAI,CACL,EACD,aAAa,CAAC,eAAe,CAC3B,YAAY,EACZ,iBAAiB,EACjB,SAAS,EACT,IAAI,CACL,CACF;IACD,IAAI,CAAC,UAAU,EAAE,YAAY,GAAG,YAAY,CAAC,MAAM,EAAE;IACrD,OAAO,YAAY;EACrB;EAEO,MAAM,wBAAwB,CACnC,WAAmB,EACnB,SAAoB,EACpB,MAAsB,EACtB,KAAqB,EAAA;IAErB,IAAI;MACF,MAAM,aAAa,GAAG,SAAS,IAAI,SAAS,CAAC,WAAW,GAAG,MAAM,GAAG,KAAK;MACzE,IAAI,OAAO;MACX,IAAI,aAAa,CAAC,QAAQ,CAAC,QAAQ,EAAE;QACnC,OAAO,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,WAAW,CAAC;OACtD,MAAM;QACL,MAAM,aAAa,GAAG,cAAc,CAAC,OAAO,CAC1C,aAAa,CAAC,QAAQ,CAAC,OAAO,EAC9B,IAAI,CAAC,QAAQ,CACd;QACD,OAAO,GAAG,MAAM,aAAa,CAAC,SAAS,CAAC,WAAW,CAAC;MACrD;MACD,OAAO,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC;KACtE,CAAC,OAAO,CAAC,EAAE;MACV,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE,mCAAmC,CAAC;MACjD,OAAO,KAAK;IACb;EACH;EAEQ,aAAa,CAAC,QAAkB,EAAA;IACtC,MAAM,YAAY,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,GAClE,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,SAAS,CAAC,GACnC,QAAQ,CAAC,SAAS;IACtB,MAAM,cAAc,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,WAAW,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,GACtE,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,WAAW,CAAC,GACrC,QAAQ,CAAC,WAAW;IACxB,OAAO,IAAI,QAAQ,CAAC,YAAY,EAAE,cAAc,CAAC;EACnD;EAEQ,qBAAqB,GAAA;IAC3B,OAAO,KAAK,CACV,OAAO,EAAE,EAAE,OAAO,KAAI;MACpB,IAAI,OAAO,GAAG,CAAC,EAAE;QACf,GAAG,CAAC,IAAI,CAAC,4BAA4B,OAAO,EAAE,CAAC;MAChD;MACD,OAAO,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE;IACvC,CAAC,EACD;MACE,OAAO,EAAE,CAAC;MACV,UAAU,EAAE,GAAG;MACf,UAAU,EAAE;KACb,CACF;EACH;AACD","sourceRoot":"","sourcesContent":["import { BigNumber } from '@ethersproject/bignumber';\nimport { JsonRpcProvider } from '@ethersproject/providers';\nimport DEFAULT_TOKEN_LIST from '@uniswap/default-token-list';\nimport { Protocol, SwapRouter } from '@uniswap/router-sdk';\nimport { Fraction, TradeType } from '@uniswap/sdk-core';\nimport { Pool, Position, SqrtPriceMath, TickMath } from '@uniswap/v3-sdk';\nimport retry from 'async-retry';\nimport JSBI from 'jsbi';\nimport _ from 'lodash';\nimport NodeCache from 'node-cache';\nimport { CachingGasStationProvider, CachingTokenProviderWithFallback, CachingV2PoolProvider, CachingV2SubgraphProvider, CachingV3PoolProvider, CachingV3SubgraphProvider, EIP1559GasPriceProvider, ETHGasStationInfoProvider, LegacyGasPriceProvider, NodeJSCache, OnChainGasPriceProvider, OnChainQuoteProvider, StaticV2SubgraphProvider, StaticV3SubgraphProvider, SwapRouterProvider, UniswapMulticallProvider, URISubgraphProvider, V2QuoteProvider, V2SubgraphProviderWithFallBacks, V3SubgraphProviderWithFallBacks, } from '../../providers';\nimport { CachingTokenListProvider } from '../../providers/caching-token-list-provider';\nimport { TokenProvider } from '../../providers/token-provider';\nimport { TokenValidatorProvider, } from '../../providers/token-validator-provider';\nimport { V2PoolProvider } from '../../providers/v2/pool-provider';\nimport { ArbitrumGasDataProvider, OptimismGasDataProvider, } from '../../providers/v3/gas-data-provider';\nimport { V3PoolProvider } from '../../providers/v3/pool-provider';\nimport { Erc20__factory } from '../../types/other/factories/Erc20__factory';\nimport { SWAP_ROUTER_02_ADDRESSES } from '../../util';\nimport { CurrencyAmount } from '../../util/amounts';\nimport { ChainId, ID_TO_CHAIN_ID, ID_TO_NETWORK_NAME, V2_SUPPORTED } from '../../util/chains';\nimport { log } from '../../util/log';\nimport { buildSwapMethodParameters, buildTrade } from '../../util/methodParameters';\nimport { metric, MetricLoggerUnit } from '../../util/metric';\nimport { UNSUPPORTED_TOKENS } from '../../util/unsupported-tokens';\nimport { SwapToRatioStatus, } from '../router';\nimport { DEFAULT_ROUTING_CONFIG_BY_CHAIN, ETH_GAS_STATION_API_URL } from './config';\nimport { getBestSwapRoute } from './functions/best-swap-route';\nimport { calculateRatioAmountIn } from './functions/calculate-ratio-amount-in';\nimport { MixedRouteHeuristicGasModelFactory } from './gas-models/mixedRoute/mixed-route-heuristic-gas-model';\nimport { V2HeuristicGasModelFactory } from './gas-models/v2/v2-heuristic-gas-model';\nimport { V3HeuristicGasModelFactory } from './gas-models/v3/v3-heuristic-gas-model';\nimport { MixedQuoter, V2Quoter, V3Quoter } from './quoters';\nexport class AlphaRouter {\n    constructor({ chainId, provider, multicall2Provider, v3PoolProvider, onChainQuoteProvider, v2PoolProvider, v2QuoteProvider, v2SubgraphProvider, tokenProvider, blockedTokenListProvider, v3SubgraphProvider, gasPriceProvider, v3GasModelFactory, v2GasModelFactory, mixedRouteGasModelFactory, swapRouterProvider, optimismGasDataProvider, tokenValidatorProvider, arbitrumGasDataProvider, simulator, }) {\n        this.chainId = chainId;\n        this.provider = provider;\n        this.multicall2Provider =\n            multicall2Provider !== null && multicall2Provider !== void 0 ? multicall2Provider : new UniswapMulticallProvider(chainId, provider, 375000);\n        this.v3PoolProvider =\n            v3PoolProvider !== null && v3PoolProvider !== void 0 ? v3PoolProvider : new CachingV3PoolProvider(this.chainId, new V3PoolProvider(ID_TO_CHAIN_ID(chainId), this.multicall2Provider), new NodeJSCache(new NodeCache({ stdTTL: 360, useClones: false })));\n        this.simulator = simulator;\n        if (onChainQuoteProvider) {\n            this.onChainQuoteProvider = onChainQuoteProvider;\n        }\n        else {\n            switch (chainId) {\n                case ChainId.OPTIMISM:\n                case ChainId.OPTIMISM_GOERLI:\n                case ChainId.OPTIMISTIC_KOVAN:\n                    this.onChainQuoteProvider = new OnChainQuoteProvider(chainId, provider, this.multicall2Provider, {\n                        retries: 2,\n                        minTimeout: 100,\n                        maxTimeout: 1000,\n                    }, {\n                        multicallChunk: 110,\n                        gasLimitPerCall: 1200000,\n                        quoteMinSuccessRate: 0.1,\n                    }, {\n                        gasLimitOverride: 3000000,\n                        multicallChunk: 45,\n                    }, {\n                        gasLimitOverride: 3000000,\n                        multicallChunk: 45,\n                    }, {\n                        baseBlockOffset: -10,\n                        rollback: {\n                            enabled: true,\n                            attemptsBeforeRollback: 1,\n                            rollbackBlockOffset: -10,\n                        },\n                    });\n                    break;\n                case ChainId.ARBITRUM_ONE:\n                case ChainId.ARBITRUM_RINKEBY:\n                case ChainId.ARBITRUM_GOERLI:\n                    this.onChainQuoteProvider = new OnChainQuoteProvider(chainId, provider, this.multicall2Provider, {\n                        retries: 2,\n                        minTimeout: 100,\n                        maxTimeout: 1000,\n                    }, {\n                        multicallChunk: 10,\n                        gasLimitPerCall: 12000000,\n                        quoteMinSuccessRate: 0.1,\n                    }, {\n                        gasLimitOverride: 30000000,\n                        multicallChunk: 6,\n                    }, {\n                        gasLimitOverride: 30000000,\n                        multicallChunk: 6,\n                    });\n                    break;\n                case ChainId.CELO:\n                case ChainId.CELO_ALFAJORES:\n                    this.onChainQuoteProvider = new OnChainQuoteProvider(chainId, provider, this.multicall2Provider, {\n                        retries: 2,\n                        minTimeout: 100,\n                        maxTimeout: 1000,\n                    }, {\n                        multicallChunk: 10,\n                        gasLimitPerCall: 5000000,\n                        quoteMinSuccessRate: 0.1,\n                    }, {\n                        gasLimitOverride: 5000000,\n                        multicallChunk: 5,\n                    }, {\n                        gasLimitOverride: 6250000,\n                        multicallChunk: 4,\n                    });\n                    break;\n                default:\n                    this.onChainQuoteProvider = new OnChainQuoteProvider(chainId, provider, this.multicall2Provider, {\n                        retries: 2,\n                        minTimeout: 100,\n                        maxTimeout: 1000,\n                    }, {\n                        multicallChunk: 210,\n                        gasLimitPerCall: 705000,\n                        quoteMinSuccessRate: 0.15,\n                    }, {\n                        gasLimitOverride: 2000000,\n                        multicallChunk: 70,\n                    });\n                    break;\n            }\n        }\n        this.v2PoolProvider =\n            v2PoolProvider !== null && v2PoolProvider !== void 0 ? v2PoolProvider : new CachingV2PoolProvider(chainId, new V2PoolProvider(chainId, this.multicall2Provider), new NodeJSCache(new NodeCache({ stdTTL: 60, useClones: false })));\n        this.v2QuoteProvider = v2QuoteProvider !== null && v2QuoteProvider !== void 0 ? v2QuoteProvider : new V2QuoteProvider();\n        this.blockedTokenListProvider =\n            blockedTokenListProvider !== null && blockedTokenListProvider !== void 0 ? blockedTokenListProvider : new CachingTokenListProvider(chainId, UNSUPPORTED_TOKENS, new NodeJSCache(new NodeCache({ stdTTL: 3600, useClones: false })));\n        this.tokenProvider =\n            tokenProvider !== null && tokenProvider !== void 0 ? tokenProvider : new CachingTokenProviderWithFallback(chainId, new NodeJSCache(new NodeCache({ stdTTL: 3600, useClones: false })), new CachingTokenListProvider(chainId, DEFAULT_TOKEN_LIST, new NodeJSCache(new NodeCache({ stdTTL: 3600, useClones: false }))), new TokenProvider(chainId, this.multicall2Provider));\n        const chainName = ID_TO_NETWORK_NAME(chainId);\n        // ipfs urls in the following format: `https://cloudflare-ipfs.com/ipns/api.uniswap.org/v1/pools/${protocol}/${chainName}.json`;\n        if (v2SubgraphProvider) {\n            this.v2SubgraphProvider = v2SubgraphProvider;\n        }\n        else {\n            this.v2SubgraphProvider = new V2SubgraphProviderWithFallBacks([\n                new CachingV2SubgraphProvider(chainId, new URISubgraphProvider(chainId, `https://cloudflare-ipfs.com/ipns/api.uniswap.org/v1/pools/v2/${chainName}.json`, undefined, 0), new NodeJSCache(new NodeCache({ stdTTL: 300, useClones: false }))),\n                new StaticV2SubgraphProvider(chainId),\n            ]);\n        }\n        if (v3SubgraphProvider) {\n            this.v3SubgraphProvider = v3SubgraphProvider;\n        }\n        else {\n            this.v3SubgraphProvider = new V3SubgraphProviderWithFallBacks([\n                new CachingV3SubgraphProvider(chainId, new URISubgraphProvider(chainId, `https://cloudflare-ipfs.com/ipns/api.uniswap.org/v1/pools/v3/${chainName}.json`, undefined, 0), new NodeJSCache(new NodeCache({ stdTTL: 300, useClones: false }))),\n                new StaticV3SubgraphProvider(chainId, this.v3PoolProvider),\n            ]);\n        }\n        let gasPriceProviderInstance;\n        if (this.provider instanceof JsonRpcProvider) {\n            gasPriceProviderInstance = new OnChainGasPriceProvider(chainId, new EIP1559GasPriceProvider(this.provider), new LegacyGasPriceProvider(this.provider));\n        }\n        else {\n            gasPriceProviderInstance = new ETHGasStationInfoProvider(ETH_GAS_STATION_API_URL);\n        }\n        this.gasPriceProvider =\n            gasPriceProvider !== null && gasPriceProvider !== void 0 ? gasPriceProvider : new CachingGasStationProvider(chainId, gasPriceProviderInstance, new NodeJSCache(new NodeCache({ stdTTL: 15, useClones: false })));\n        this.v3GasModelFactory =\n            v3GasModelFactory !== null && v3GasModelFactory !== void 0 ? v3GasModelFactory : new V3HeuristicGasModelFactory();\n        this.v2GasModelFactory =\n            v2GasModelFactory !== null && v2GasModelFactory !== void 0 ? v2GasModelFactory : new V2HeuristicGasModelFactory();\n        this.mixedRouteGasModelFactory =\n            mixedRouteGasModelFactory !== null && mixedRouteGasModelFactory !== void 0 ? mixedRouteGasModelFactory : new MixedRouteHeuristicGasModelFactory();\n        this.swapRouterProvider =\n            swapRouterProvider !== null && swapRouterProvider !== void 0 ? swapRouterProvider : new SwapRouterProvider(this.multicall2Provider, this.chainId);\n        if (chainId == ChainId.OPTIMISM || chainId == ChainId.OPTIMISTIC_KOVAN) {\n            this.l2GasDataProvider =\n                optimismGasDataProvider !== null && optimismGasDataProvider !== void 0 ? optimismGasDataProvider : new OptimismGasDataProvider(chainId, this.multicall2Provider);\n        }\n        if (chainId == ChainId.ARBITRUM_ONE ||\n            chainId == ChainId.ARBITRUM_RINKEBY ||\n            chainId == ChainId.ARBITRUM_GOERLI) {\n            this.l2GasDataProvider =\n                arbitrumGasDataProvider !== null && arbitrumGasDataProvider !== void 0 ? arbitrumGasDataProvider : new ArbitrumGasDataProvider(chainId, this.provider);\n        }\n        if (tokenValidatorProvider) {\n            this.tokenValidatorProvider = tokenValidatorProvider;\n        }\n        else if (this.chainId == ChainId.MAINNET) {\n            this.tokenValidatorProvider = new TokenValidatorProvider(this.chainId, this.multicall2Provider, new NodeJSCache(new NodeCache({ stdTTL: 30000, useClones: false })));\n        }\n        // Initialize the Quoters.\n        // Quoters are an abstraction encapsulating the business logic of fetching routes and quotes.\n        this.v2Quoter = new V2Quoter(this.v2SubgraphProvider, this.v2PoolProvider, this.v2QuoteProvider, this.v2GasModelFactory, this.tokenProvider, this.chainId, this.blockedTokenListProvider, this.tokenValidatorProvider);\n        this.v3Quoter = new V3Quoter(this.v3SubgraphProvider, this.v3PoolProvider, this.onChainQuoteProvider, this.tokenProvider, this.chainId, this.blockedTokenListProvider, this.tokenValidatorProvider);\n        this.mixedQuoter = new MixedQuoter(this.v3SubgraphProvider, this.v3PoolProvider, this.v2SubgraphProvider, this.v2PoolProvider, this.onChainQuoteProvider, this.tokenProvider, this.chainId, this.blockedTokenListProvider, this.tokenValidatorProvider);\n    }\n    async routeToRatio(token0Balance, token1Balance, position, swapAndAddConfig, swapAndAddOptions, routingConfig = DEFAULT_ROUTING_CONFIG_BY_CHAIN(this.chainId)) {\n        if (token1Balance.currency.wrapped.sortsBefore(token0Balance.currency.wrapped)) {\n            [token0Balance, token1Balance] = [token1Balance, token0Balance];\n        }\n        let preSwapOptimalRatio = this.calculateOptimalRatio(position, position.pool.sqrtRatioX96, true);\n        // set up parameters according to which token will be swapped\n        let zeroForOne;\n        if (position.pool.tickCurrent > position.tickUpper) {\n            zeroForOne = true;\n        }\n        else if (position.pool.tickCurrent < position.tickLower) {\n            zeroForOne = false;\n        }\n        else {\n            zeroForOne = new Fraction(token0Balance.quotient, token1Balance.quotient).greaterThan(preSwapOptimalRatio);\n            if (!zeroForOne)\n                preSwapOptimalRatio = preSwapOptimalRatio.invert();\n        }\n        const [inputBalance, outputBalance] = zeroForOne\n            ? [token0Balance, token1Balance]\n            : [token1Balance, token0Balance];\n        let optimalRatio = preSwapOptimalRatio;\n        let postSwapTargetPool = position.pool;\n        let exchangeRate = zeroForOne\n            ? position.pool.token0Price\n            : position.pool.token1Price;\n        let swap = null;\n        let ratioAchieved = false;\n        let n = 0;\n        // iterate until we find a swap with a sufficient ratio or return null\n        while (!ratioAchieved) {\n            n++;\n            if (n > swapAndAddConfig.maxIterations) {\n                log.info('max iterations exceeded');\n                return {\n                    status: SwapToRatioStatus.NO_ROUTE_FOUND,\n                    error: 'max iterations exceeded',\n                };\n            }\n            const amountToSwap = calculateRatioAmountIn(optimalRatio, exchangeRate, inputBalance, outputBalance);\n            if (amountToSwap.equalTo(0)) {\n                log.info(`no swap needed: amountToSwap = 0`);\n                return {\n                    status: SwapToRatioStatus.NO_SWAP_NEEDED,\n                };\n            }\n            swap = await this.route(amountToSwap, outputBalance.currency, TradeType.EXACT_INPUT, undefined, {\n                ...DEFAULT_ROUTING_CONFIG_BY_CHAIN(this.chainId),\n                ...routingConfig,\n                /// @dev We do not want to query for mixedRoutes for routeToRatio as they are not supported\n                /// [Protocol.V3, Protocol.V2] will make sure we only query for V3 and V2\n                protocols: [Protocol.V3, Protocol.V2],\n            });\n            if (!swap) {\n                log.info('no route found from this.route()');\n                return {\n                    status: SwapToRatioStatus.NO_ROUTE_FOUND,\n                    error: 'no route found',\n                };\n            }\n            const inputBalanceUpdated = inputBalance.subtract(swap.trade.inputAmount);\n            const outputBalanceUpdated = outputBalance.add(swap.trade.outputAmount);\n            const newRatio = inputBalanceUpdated.divide(outputBalanceUpdated);\n            let targetPoolPriceUpdate;\n            swap.route.forEach((route) => {\n                if (route.protocol == Protocol.V3) {\n                    const v3Route = route;\n                    v3Route.route.pools.forEach((pool, i) => {\n                        if (pool.token0.equals(position.pool.token0) &&\n                            pool.token1.equals(position.pool.token1) &&\n                            pool.fee == position.pool.fee) {\n                            targetPoolPriceUpdate = JSBI.BigInt(v3Route.sqrtPriceX96AfterList[i].toString());\n                            optimalRatio = this.calculateOptimalRatio(position, JSBI.BigInt(targetPoolPriceUpdate.toString()), zeroForOne);\n                        }\n                    });\n                }\n            });\n            if (!targetPoolPriceUpdate) {\n                optimalRatio = preSwapOptimalRatio;\n            }\n            ratioAchieved =\n                newRatio.equalTo(optimalRatio) ||\n                    this.absoluteValue(newRatio.asFraction.divide(optimalRatio).subtract(1)).lessThan(swapAndAddConfig.ratioErrorTolerance);\n            if (ratioAchieved && targetPoolPriceUpdate) {\n                postSwapTargetPool = new Pool(position.pool.token0, position.pool.token1, position.pool.fee, targetPoolPriceUpdate, position.pool.liquidity, TickMath.getTickAtSqrtRatio(targetPoolPriceUpdate), position.pool.tickDataProvider);\n            }\n            exchangeRate = swap.trade.outputAmount.divide(swap.trade.inputAmount);\n            log.info({\n                exchangeRate: exchangeRate.asFraction.toFixed(18),\n                optimalRatio: optimalRatio.asFraction.toFixed(18),\n                newRatio: newRatio.asFraction.toFixed(18),\n                inputBalanceUpdated: inputBalanceUpdated.asFraction.toFixed(18),\n                outputBalanceUpdated: outputBalanceUpdated.asFraction.toFixed(18),\n                ratioErrorTolerance: swapAndAddConfig.ratioErrorTolerance.toFixed(18),\n                iterationN: n.toString(),\n            }, 'QuoteToRatio Iteration Parameters');\n            if (exchangeRate.equalTo(0)) {\n                log.info('exchangeRate to 0');\n                return {\n                    status: SwapToRatioStatus.NO_ROUTE_FOUND,\n                    error: 'insufficient liquidity to swap to optimal ratio',\n                };\n            }\n        }\n        if (!swap) {\n            return {\n                status: SwapToRatioStatus.NO_ROUTE_FOUND,\n                error: 'no route found',\n            };\n        }\n        let methodParameters;\n        if (swapAndAddOptions) {\n            methodParameters = await this.buildSwapAndAddMethodParameters(swap.trade, swapAndAddOptions, {\n                initialBalanceTokenIn: inputBalance,\n                initialBalanceTokenOut: outputBalance,\n                preLiquidityPosition: position,\n            });\n        }\n        return {\n            status: SwapToRatioStatus.SUCCESS,\n            result: { ...swap, methodParameters, optimalRatio, postSwapTargetPool },\n        };\n    }\n    /**\n     * @inheritdoc IRouter\n     */\n    async route(amount, quoteCurrency, tradeType, swapConfig, partialRoutingConfig = {}) {\n        var _a;\n        metric.putMetric(`QuoteRequestedForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n        // Get a block number to specify in all our calls. Ensures data we fetch from chain is\n        // from the same block.\n        const blockNumber = (_a = partialRoutingConfig.blockNumber) !== null && _a !== void 0 ? _a : this.getBlockNumberPromise();\n        const routingConfig = _.merge({}, DEFAULT_ROUTING_CONFIG_BY_CHAIN(this.chainId), partialRoutingConfig, { blockNumber });\n        const { currencyIn, currencyOut } = this.determineCurrencyInOutFromTradeType(tradeType, amount, quoteCurrency);\n        const tokenIn = currencyIn.wrapped;\n        const tokenOut = currencyOut.wrapped;\n        // Generate our distribution of amounts, i.e. fractions of the input amount.\n        // We will get quotes for fractions of the input amount for different routes, then\n        // combine to generate split routes.\n        const [percents, amounts] = this.getAmountDistribution(amount, routingConfig);\n        const gasPriceWei = await this.getGasPriceWei();\n        const quoteToken = quoteCurrency.wrapped;\n        const quotePromises = [];\n        const [v3gasModel, mixedRouteGasModel] = await this.getGasModels(gasPriceWei, amount.currency.wrapped, quoteToken);\n        // Create a Set to sanitize the protocols input, a Set of undefined becomes an empty set,\n        // Then create an Array from the values of that Set.\n        const protocols = Array.from(new Set(routingConfig.protocols).values());\n        const noProtocolsSpecified = protocols.length == 0;\n        const v3ProtocolSpecified = protocols.includes(Protocol.V3);\n        const v2ProtocolSpecified = protocols.includes(Protocol.V2);\n        const v2SupportedInChain = V2_SUPPORTED.includes(this.chainId);\n        const shouldQueryMixedProtocol = protocols.includes(Protocol.MIXED) || (noProtocolsSpecified && v2SupportedInChain);\n        const mixedProtocolAllowed = [ChainId.MAINNET, ChainId.GÖRLI].includes(this.chainId) &&\n            tradeType === TradeType.EXACT_INPUT;\n        // Maybe Quote V3 - if V3 is specified, or no protocol is specified\n        if (v3ProtocolSpecified || noProtocolsSpecified) {\n            log.info({ protocols, tradeType }, 'Routing across V3');\n            quotePromises.push(this.v3Quoter.getRoutesThenQuotes(tokenIn, tokenOut, amounts, percents, quoteToken, tradeType, routingConfig, v3gasModel));\n        }\n        // Maybe Quote V2 - if V2 is specified, or no protocol is specified AND v2 is supported in this chain\n        if (v2SupportedInChain && (v2ProtocolSpecified || noProtocolsSpecified)) {\n            log.info({ protocols, tradeType }, 'Routing across V2');\n            quotePromises.push(this.v2Quoter.getRoutesThenQuotes(tokenIn, tokenOut, amounts, percents, quoteToken, tradeType, routingConfig, undefined, gasPriceWei));\n        }\n        // Maybe Quote mixed routes\n        // if MixedProtocol is specified or no protocol is specified and v2 is supported AND tradeType is ExactIn\n        // AND is Mainnet or Gorli\n        if (shouldQueryMixedProtocol && mixedProtocolAllowed) {\n            log.info({ protocols, tradeType }, 'Routing across MixedRoutes');\n            quotePromises.push(this.mixedQuoter.getRoutesThenQuotes(tokenIn, tokenOut, amounts, percents, quoteToken, tradeType, routingConfig, mixedRouteGasModel));\n        }\n        const routesWithValidQuotesByProtocol = await Promise.all(quotePromises);\n        // The following block of code performs a manual reduce operation\n        // from the Array<RouteWithValidQuote[],CandidatePoolsBySelectionCriteria>\n        // to 2 arrays: RouteWithValidQuote[] AND CandidatePoolsBySelectionCriteria[]\n        let allRoutesWithValidQuotes = [];\n        let allCandidatePools = [];\n        for (const { routesWithValidQuotes, candidatePools, } of routesWithValidQuotesByProtocol) {\n            allRoutesWithValidQuotes = [\n                ...allRoutesWithValidQuotes,\n                ...routesWithValidQuotes,\n            ];\n            if (candidatePools) {\n                allCandidatePools = [...allCandidatePools, candidatePools];\n            }\n        }\n        if (allRoutesWithValidQuotes.length == 0) {\n            log.info({ allRoutesWithValidQuotes }, 'Received no valid quotes');\n            return null;\n        }\n        // Given all the quotes for all the amounts for all the routes, find the best combination.\n        const beforeBestSwap = Date.now();\n        const swapRouteRaw = await getBestSwapRoute(amount, percents, allRoutesWithValidQuotes, tradeType, this.chainId, routingConfig, v3gasModel);\n        if (!swapRouteRaw) {\n            return null;\n        }\n        const { quote, quoteGasAdjusted, estimatedGasUsed, routes: routeAmounts, estimatedGasUsedQuoteToken, estimatedGasUsedUSD, } = swapRouteRaw;\n        // Build Trade object that represents the optimal swap.\n        const trade = buildTrade(currencyIn, currencyOut, tradeType, routeAmounts);\n        let methodParameters;\n        // If user provided recipient, deadline etc. we also generate the calldata required to execute\n        // the swap and return it too.\n        if (swapConfig) {\n            methodParameters = buildSwapMethodParameters(trade, swapConfig, this.chainId);\n        }\n        metric.putMetric('FindBestSwapRoute', Date.now() - beforeBestSwap, MetricLoggerUnit.Milliseconds);\n        metric.putMetric(`QuoteFoundForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n        this.emitPoolSelectionMetrics(swapRouteRaw, allCandidatePools);\n        const swapRoute = {\n            quote,\n            quoteGasAdjusted,\n            estimatedGasUsed,\n            estimatedGasUsedQuoteToken,\n            estimatedGasUsedUSD,\n            gasPriceWei,\n            route: routeAmounts,\n            trade,\n            methodParameters,\n            blockNumber: BigNumber.from(await blockNumber),\n        };\n        if (swapConfig &&\n            swapConfig.simulate &&\n            methodParameters &&\n            methodParameters.calldata) {\n            if (!this.simulator) {\n                throw new Error('Simulator not initialized!');\n            }\n            log.info({ swapConfig, methodParameters }, 'Starting simulation');\n            const fromAddress = swapConfig.simulate.fromAddress;\n            const beforeSimulate = Date.now();\n            const swapRouteWithSimulation = await this.simulator.simulate(fromAddress, swapConfig, swapRoute, amount, \n            // Quote will be in WETH even if quoteCurrency is ETH\n            // So we init a new CurrencyAmount object here\n            CurrencyAmount.fromRawAmount(quoteCurrency, quote.quotient.toString()), this.l2GasDataProvider\n                ? await this.l2GasDataProvider.getGasData()\n                : undefined, { blockNumber });\n            metric.putMetric('SimulateTransaction', Date.now() - beforeSimulate, MetricLoggerUnit.Milliseconds);\n            return swapRouteWithSimulation;\n        }\n        return swapRoute;\n    }\n    determineCurrencyInOutFromTradeType(tradeType, amount, quoteCurrency) {\n        if (tradeType == TradeType.EXACT_INPUT) {\n            return {\n                currencyIn: amount.currency,\n                currencyOut: quoteCurrency\n            };\n        }\n        else {\n            return {\n                currencyIn: quoteCurrency,\n                currencyOut: amount.currency\n            };\n        }\n    }\n    async getGasPriceWei() {\n        // Track how long it takes to resolve this async call.\n        const beforeGasTimestamp = Date.now();\n        // Get an estimate of the gas price to use when estimating gas cost of different routes.\n        const { gasPriceWei } = await this.gasPriceProvider.getGasPrice();\n        metric.putMetric('GasPriceLoad', Date.now() - beforeGasTimestamp, MetricLoggerUnit.Milliseconds);\n        return gasPriceWei;\n    }\n    async getGasModels(gasPriceWei, amountToken, quoteToken) {\n        const beforeGasModel = Date.now();\n        const v3GasModelPromise = this.v3GasModelFactory.buildGasModel({\n            chainId: this.chainId,\n            gasPriceWei,\n            v3poolProvider: this.v3PoolProvider,\n            amountToken,\n            quoteToken,\n            v2poolProvider: this.v2PoolProvider,\n            l2GasDataProvider: this.l2GasDataProvider,\n        });\n        const mixedRouteGasModelPromise = this.mixedRouteGasModelFactory.buildGasModel({\n            chainId: this.chainId,\n            gasPriceWei,\n            v3poolProvider: this.v3PoolProvider,\n            amountToken,\n            quoteToken,\n            v2poolProvider: this.v2PoolProvider,\n        });\n        const [v3GasModel, mixedRouteGasModel] = await Promise.all([\n            v3GasModelPromise,\n            mixedRouteGasModelPromise\n        ]);\n        metric.putMetric('GasModelCreation', Date.now() - beforeGasModel, MetricLoggerUnit.Milliseconds);\n        return [v3GasModel, mixedRouteGasModel];\n    }\n    // Note multiplications here can result in a loss of precision in the amounts (e.g. taking 50% of 101)\n    // This is reconcilled at the end of the algorithm by adding any lost precision to one of\n    // the splits in the route.\n    getAmountDistribution(amount, routingConfig) {\n        const { distributionPercent } = routingConfig;\n        const percents = [];\n        const amounts = [];\n        for (let i = 1; i <= 100 / distributionPercent; i++) {\n            percents.push(i * distributionPercent);\n            amounts.push(amount.multiply(new Fraction(i * distributionPercent, 100)));\n        }\n        return [percents, amounts];\n    }\n    async buildSwapAndAddMethodParameters(trade, swapAndAddOptions, swapAndAddParameters) {\n        const { swapOptions: { recipient, slippageTolerance, deadline, inputTokenPermit }, addLiquidityOptions: addLiquidityConfig, } = swapAndAddOptions;\n        const preLiquidityPosition = swapAndAddParameters.preLiquidityPosition;\n        const finalBalanceTokenIn = swapAndAddParameters.initialBalanceTokenIn.subtract(trade.inputAmount);\n        const finalBalanceTokenOut = swapAndAddParameters.initialBalanceTokenOut.add(trade.outputAmount);\n        const approvalTypes = await this.swapRouterProvider.getApprovalType(finalBalanceTokenIn, finalBalanceTokenOut);\n        const zeroForOne = finalBalanceTokenIn.currency.wrapped.sortsBefore(finalBalanceTokenOut.currency.wrapped);\n        return {\n            ...SwapRouter.swapAndAddCallParameters(trade, {\n                recipient,\n                slippageTolerance,\n                deadlineOrPreviousBlockhash: deadline,\n                inputTokenPermit,\n            }, Position.fromAmounts({\n                pool: preLiquidityPosition.pool,\n                tickLower: preLiquidityPosition.tickLower,\n                tickUpper: preLiquidityPosition.tickUpper,\n                amount0: zeroForOne\n                    ? finalBalanceTokenIn.quotient.toString()\n                    : finalBalanceTokenOut.quotient.toString(),\n                amount1: zeroForOne\n                    ? finalBalanceTokenOut.quotient.toString()\n                    : finalBalanceTokenIn.quotient.toString(),\n                useFullPrecision: false,\n            }), addLiquidityConfig, approvalTypes.approvalTokenIn, approvalTypes.approvalTokenOut),\n            to: SWAP_ROUTER_02_ADDRESSES(this.chainId),\n        };\n    }\n    emitPoolSelectionMetrics(swapRouteRaw, allPoolsBySelection) {\n        const poolAddressesUsed = new Set();\n        const { routes: routeAmounts } = swapRouteRaw;\n        _(routeAmounts)\n            .flatMap((routeAmount) => {\n            const { poolAddresses } = routeAmount;\n            return poolAddresses;\n        })\n            .forEach((address) => {\n            poolAddressesUsed.add(address.toLowerCase());\n        });\n        for (const poolsBySelection of allPoolsBySelection) {\n            const { protocol } = poolsBySelection;\n            _.forIn(poolsBySelection.selections, (pools, topNSelection) => {\n                const topNUsed = _.findLastIndex(pools, (pool) => poolAddressesUsed.has(pool.id.toLowerCase())) + 1;\n                metric.putMetric(_.capitalize(`${protocol}${topNSelection}`), topNUsed, MetricLoggerUnit.Count);\n            });\n        }\n        let hasV3Route = false;\n        let hasV2Route = false;\n        let hasMixedRoute = false;\n        for (const routeAmount of routeAmounts) {\n            if (routeAmount.protocol == Protocol.V3) {\n                hasV3Route = true;\n            }\n            if (routeAmount.protocol == Protocol.V2) {\n                hasV2Route = true;\n            }\n            if (routeAmount.protocol == Protocol.MIXED) {\n                hasMixedRoute = true;\n            }\n        }\n        if (hasMixedRoute && (hasV3Route || hasV2Route)) {\n            if (hasV3Route && hasV2Route) {\n                metric.putMetric(`MixedAndV3AndV2SplitRoute`, 1, MetricLoggerUnit.Count);\n                metric.putMetric(`MixedAndV3AndV2SplitRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n            }\n            else if (hasV3Route) {\n                metric.putMetric(`MixedAndV3SplitRoute`, 1, MetricLoggerUnit.Count);\n                metric.putMetric(`MixedAndV3SplitRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n            }\n            else if (hasV2Route) {\n                metric.putMetric(`MixedAndV2SplitRoute`, 1, MetricLoggerUnit.Count);\n                metric.putMetric(`MixedAndV2SplitRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n            }\n        }\n        else if (hasV3Route && hasV2Route) {\n            metric.putMetric(`V3AndV2SplitRoute`, 1, MetricLoggerUnit.Count);\n            metric.putMetric(`V3AndV2SplitRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n        }\n        else if (hasMixedRoute) {\n            if (routeAmounts.length > 1) {\n                metric.putMetric(`MixedSplitRoute`, 1, MetricLoggerUnit.Count);\n                metric.putMetric(`MixedSplitRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n            }\n            else {\n                metric.putMetric(`MixedRoute`, 1, MetricLoggerUnit.Count);\n                metric.putMetric(`MixedRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n            }\n        }\n        else if (hasV3Route) {\n            if (routeAmounts.length > 1) {\n                metric.putMetric(`V3SplitRoute`, 1, MetricLoggerUnit.Count);\n                metric.putMetric(`V3SplitRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n            }\n            else {\n                metric.putMetric(`V3Route`, 1, MetricLoggerUnit.Count);\n                metric.putMetric(`V3RouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n            }\n        }\n        else if (hasV2Route) {\n            if (routeAmounts.length > 1) {\n                metric.putMetric(`V2SplitRoute`, 1, MetricLoggerUnit.Count);\n                metric.putMetric(`V2SplitRouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n            }\n            else {\n                metric.putMetric(`V2Route`, 1, MetricLoggerUnit.Count);\n                metric.putMetric(`V2RouteForChain${this.chainId}`, 1, MetricLoggerUnit.Count);\n            }\n        }\n    }\n    calculateOptimalRatio(position, sqrtRatioX96, zeroForOne) {\n        const upperSqrtRatioX96 = TickMath.getSqrtRatioAtTick(position.tickUpper);\n        const lowerSqrtRatioX96 = TickMath.getSqrtRatioAtTick(position.tickLower);\n        // returns Fraction(0, 1) for any out of range position regardless of zeroForOne. Implication: function\n        // cannot be used to determine the trading direction of out of range positions.\n        if (JSBI.greaterThan(sqrtRatioX96, upperSqrtRatioX96) ||\n            JSBI.lessThan(sqrtRatioX96, lowerSqrtRatioX96)) {\n            return new Fraction(0, 1);\n        }\n        const precision = JSBI.BigInt('1' + '0'.repeat(18));\n        let optimalRatio = new Fraction(SqrtPriceMath.getAmount0Delta(sqrtRatioX96, upperSqrtRatioX96, precision, true), SqrtPriceMath.getAmount1Delta(sqrtRatioX96, lowerSqrtRatioX96, precision, true));\n        if (!zeroForOne)\n            optimalRatio = optimalRatio.invert();\n        return optimalRatio;\n    }\n    async userHasSufficientBalance(fromAddress, tradeType, amount, quote) {\n        try {\n            const neededBalance = tradeType == TradeType.EXACT_INPUT ? amount : quote;\n            let balance;\n            if (neededBalance.currency.isNative) {\n                balance = await this.provider.getBalance(fromAddress);\n            }\n            else {\n                const tokenContract = Erc20__factory.connect(neededBalance.currency.address, this.provider);\n                balance = await tokenContract.balanceOf(fromAddress);\n            }\n            return balance.gte(BigNumber.from(neededBalance.quotient.toString()));\n        }\n        catch (e) {\n            log.error(e, 'Error while checking user balance');\n            return false;\n        }\n    }\n    absoluteValue(fraction) {\n        const numeratorAbs = JSBI.lessThan(fraction.numerator, JSBI.BigInt(0))\n            ? JSBI.unaryMinus(fraction.numerator)\n            : fraction.numerator;\n        const denominatorAbs = JSBI.lessThan(fraction.denominator, JSBI.BigInt(0))\n            ? JSBI.unaryMinus(fraction.denominator)\n            : fraction.denominator;\n        return new Fraction(numeratorAbs, denominatorAbs);\n    }\n    getBlockNumberPromise() {\n        return retry(async (_b, attempt) => {\n            if (attempt > 1) {\n                log.info(`Get block number attempt ${attempt}`);\n            }\n            return this.provider.getBlockNumber();\n        }, {\n            retries: 2,\n            minTimeout: 100,\n            maxTimeout: 1000,\n        });\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWxwaGEtcm91dGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3JvdXRlcnMvYWxwaGEtcm91dGVyL2FscGhhLXJvdXRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDckQsT0FBTyxFQUFnQixlQUFlLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN6RSxPQUFPLGtCQUFrQixNQUFNLDZCQUE2QixDQUFDO0FBQzdELE9BQU8sRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFTLE1BQU0scUJBQXFCLENBQUM7QUFDbEUsT0FBTyxFQUFZLFFBQVEsRUFBUyxTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUV6RSxPQUFPLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxhQUFhLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDMUUsT0FBTyxLQUFLLE1BQU0sYUFBYSxDQUFDO0FBQ2hDLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUN4QixPQUFPLENBQUMsTUFBTSxRQUFRLENBQUM7QUFDdkIsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFDO0FBRW5DLE9BQU8sRUFDTCx5QkFBeUIsRUFDekIsZ0NBQWdDLEVBQ2hDLHFCQUFxQixFQUNyQix5QkFBeUIsRUFDekIscUJBQXFCLEVBQ3JCLHlCQUF5QixFQUN6Qix1QkFBdUIsRUFDdkIseUJBQXlCLEVBS3pCLHNCQUFzQixFQUN0QixXQUFXLEVBQ1gsdUJBQXVCLEVBQ3ZCLG9CQUFvQixFQUVwQix3QkFBd0IsRUFDeEIsd0JBQXdCLEVBQ3hCLGtCQUFrQixFQUNsQix3QkFBd0IsRUFDeEIsbUJBQW1CLEVBQ25CLGVBQWUsRUFDZiwrQkFBK0IsRUFDL0IsK0JBQStCLEdBQ2hDLE1BQU0saUJBQWlCLENBQUM7QUFDekIsT0FBTyxFQUFFLHdCQUF3QixFQUFzQixNQUFNLDZDQUE2QyxDQUFD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"]},"metadata":{},"sourceType":"module"}