{"ast":null,"code":"var _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$(),\n  _s4 = $RefreshSig$();\nimport { addressesByNetwork, SupportedChainId } from '@looksrare/sdk';\nimport { NftStandard } from 'graphql/data/__generated__/types-and-hooks';\nimport { SetPriceMethod, WarningType } from 'nft/components/profile/list/shared';\nimport { useNFTList, useSellAsset } from 'nft/hooks';\nimport { LOOKSRARE_MARKETPLACE_CONTRACT_721, LOOKSRARE_MARKETPLACE_CONTRACT_1155, X2Y2_TRANSFER_CONTRACT_721, X2Y2_TRANSFER_CONTRACT_1155 } from 'nft/queries';\nimport { OPENSEA_CROSS_CHAIN_CONDUIT } from 'nft/queries/openSea';\nimport { ListingStatus } from 'nft/types';\nimport { approveCollection, LOOKS_RARE_CREATOR_BASIS_POINTS, signListing } from 'nft/utils/listNfts';\nimport { useEffect } from 'react';\nimport { shallow } from 'zustand/shallow';\nexport async function approveCollectionRow(collectionRow, signer, setCollectionStatusAndCallback) {\n  const callback = () => approveCollectionRow(collectionRow, signer, setCollectionStatusAndCallback);\n  setCollectionStatusAndCallback(collectionRow, ListingStatus.SIGNING, callback);\n  const {\n    marketplace,\n    collectionAddress,\n    nftStandard\n  } = collectionRow;\n  const addresses = addressesByNetwork[SupportedChainId.MAINNET];\n  const spender = marketplace.name === 'OpenSea' ? OPENSEA_CROSS_CHAIN_CONDUIT : marketplace.name === 'LooksRare' ? collectionRow.nftStandard === NftStandard.Erc721 ? LOOKSRARE_MARKETPLACE_CONTRACT_721 : LOOKSRARE_MARKETPLACE_CONTRACT_1155 : marketplace.name === 'X2Y2' ? collectionRow.nftStandard === NftStandard.Erc721 ? X2Y2_TRANSFER_CONTRACT_721 : X2Y2_TRANSFER_CONTRACT_1155 : addresses.TRANSFER_MANAGER_ERC721;\n  !!collectionAddress && (await approveCollection(spender, collectionAddress, signer, newStatus => setCollectionStatusAndCallback(collectionRow, newStatus, callback), nftStandard));\n}\nexport async function signListingRow(listing, signer, provider, getLooksRareNonce, setLooksRareNonce, setListingStatusAndCallback) {\n  const looksRareNonce = getLooksRareNonce();\n  const callback = () => {\n    return signListingRow(listing, signer, provider, getLooksRareNonce, setLooksRareNonce, setListingStatusAndCallback);\n  };\n  setListingStatusAndCallback(listing, ListingStatus.SIGNING, callback);\n  const {\n    asset,\n    marketplace\n  } = listing;\n  const res = await signListing(marketplace, asset, signer, provider, looksRareNonce, newStatus => setListingStatusAndCallback(listing, newStatus, callback));\n  res && listing.marketplace.name === 'LooksRare' && setLooksRareNonce(looksRareNonce + 1);\n}\nexport const getTotalEthValue = sellAssets => {\n  const total = sellAssets.reduce((total, asset) => {\n    var _asset$newListings;\n    if ((_asset$newListings = asset.newListings) === null || _asset$newListings === void 0 ? void 0 : _asset$newListings.length) {\n      var _asset$basisPoints, _maxListing$price, _maxListing$price2;\n      const maxListing = asset.newListings.reduce((a, b) => {\n        var _a$price, _b$price;\n        return ((_a$price = a.price) !== null && _a$price !== void 0 ? _a$price : 0) > ((_b$price = b.price) !== null && _b$price !== void 0 ? _b$price : 0) ? a : b;\n      });\n      // LooksRare is a unique case where creator royalties are a flat 0.5% or 50 basis points\n      const maxFee = maxListing.marketplace.fee + (maxListing.marketplace.name === 'LooksRare' ? LOOKS_RARE_CREATOR_BASIS_POINTS : (_asset$basisPoints = asset === null || asset === void 0 ? void 0 : asset.basisPoints) !== null && _asset$basisPoints !== void 0 ? _asset$basisPoints : 0) / 100;\n      return total + ((_maxListing$price = maxListing.price) !== null && _maxListing$price !== void 0 ? _maxListing$price : 0) - ((_maxListing$price2 = maxListing.price) !== null && _maxListing$price2 !== void 0 ? _maxListing$price2 : 0) * (maxFee / 100);\n    }\n    return total;\n  }, 0);\n  return total ? Math.round(total * 10000 + Number.EPSILON) / 10000 : 0;\n};\nconst getListings = sellAssets => {\n  const newCollectionsToApprove = [];\n  const newListings = [];\n  sellAssets.forEach(asset => {\n    var _asset$marketplaces;\n    (_asset$marketplaces = asset.marketplaces) === null || _asset$marketplaces === void 0 ? void 0 : _asset$marketplaces.forEach(marketplace => {\n      var _asset$newListings2, _asset$newListings2$f;\n      const newListing = {\n        images: [asset.smallImageUrl, marketplace.icon],\n        name: asset.name || `#${asset.tokenId}`,\n        status: ListingStatus.DEFINED,\n        asset,\n        marketplace,\n        price: (_asset$newListings2 = asset.newListings) === null || _asset$newListings2 === void 0 ? void 0 : (_asset$newListings2$f = _asset$newListings2.find(listing => listing.marketplace.name === marketplace.name)) === null || _asset$newListings2$f === void 0 ? void 0 : _asset$newListings2$f.price\n      };\n      newListings.push(newListing);\n      if (!newCollectionsToApprove.some(collectionRow => collectionRow.collectionAddress === asset.asset_contract.address && collectionRow.marketplace.name === marketplace.name)) {\n        const newCollectionRow = {\n          images: [asset.asset_contract.image_url, marketplace.icon],\n          name: asset.asset_contract.name,\n          status: ListingStatus.DEFINED,\n          collectionAddress: asset.asset_contract.address,\n          isVerified: asset.collectionIsVerified,\n          marketplace,\n          nftStandard: asset.asset_contract.tokenType\n        };\n        newCollectionsToApprove.push(newCollectionRow);\n      }\n    });\n  });\n  return [newCollectionsToApprove, newListings];\n};\nexport const verifyStatus = status => {\n  return status !== ListingStatus.PAUSED && status !== ListingStatus.APPROVED;\n};\nexport function useSubscribeListingState() {\n  _s();\n  const sellAssets = useSellAsset(state => state.sellAssets);\n  const {\n    setListings,\n    setCollectionsRequiringApproval\n  } = useNFTList(_ref => {\n    let {\n      setListings,\n      setCollectionsRequiringApproval\n    } = _ref;\n    return {\n      setListings,\n      setCollectionsRequiringApproval\n    };\n  }, shallow);\n  useEffect(() => {\n    const [newCollectionsToApprove, newListings] = getListings(sellAssets);\n    setListings(newListings);\n    setCollectionsRequiringApproval(newCollectionsToApprove);\n  }, [sellAssets, setCollectionsRequiringApproval, setListings]);\n}\n_s(useSubscribeListingState, \"+PLAG+HVAzmpCgGEvq7B/ZYTQqU=\", false, function () {\n  return [useSellAsset, useNFTList];\n});\nexport function useHandleGlobalPriceToggle(globalOverride, setListPrice, setPrice, listPrice, globalPrice) {\n  _s2();\n  useEffect(() => {\n    let price;\n    if (globalOverride) {\n      if (!listPrice) setListPrice(globalPrice);\n      price = globalPrice;\n    } else {\n      price = listPrice;\n    }\n    setPrice(price);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [globalOverride]);\n}\n_s2(useHandleGlobalPriceToggle, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\nexport function useSyncPriceWithGlobalMethod(asset, setListPrice, setGlobalPrice, setGlobalOverride, listPrice, globalPrice, globalPriceMethod) {\n  _s3();\n  useEffect(() => {\n    if (globalPriceMethod === SetPriceMethod.FLOOR_PRICE) {\n      setListPrice(asset === null || asset === void 0 ? void 0 : asset.floorPrice);\n      setGlobalPrice(asset.floorPrice);\n    } else if (globalPriceMethod === SetPriceMethod.LAST_PRICE) {\n      setListPrice(asset.lastPrice);\n      setGlobalPrice(asset.lastPrice);\n    } else if (globalPriceMethod === SetPriceMethod.SAME_PRICE) listPrice && !globalPrice ? setGlobalPrice(listPrice) : setListPrice(globalPrice);\n    setGlobalOverride(false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [globalPriceMethod]);\n}\n_s3(useSyncPriceWithGlobalMethod, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\nexport function useUpdateInputAndWarnings(setWarningType, inputRef, asset, listPrice) {\n  _s4();\n  useEffect(() => {\n    var _asset$floorPrice;\n    setWarningType(WarningType.NONE);\n    const price = listPrice !== null && listPrice !== void 0 ? listPrice : 0;\n    inputRef.current.value = `${price}`;\n    if (price < ((_asset$floorPrice = asset === null || asset === void 0 ? void 0 : asset.floorPrice) !== null && _asset$floorPrice !== void 0 ? _asset$floorPrice : 0) && price > 0) setWarningType(WarningType.BELOW_FLOOR);else if (asset.floor_sell_order_price && price >= asset.floor_sell_order_price && asset.asset_contract.tokenType !== NftStandard.Erc1155) setWarningType(WarningType.ALREADY_LISTED);\n  }, [asset.asset_contract.tokenType, asset === null || asset === void 0 ? void 0 : asset.floorPrice, asset.floor_sell_order_price, inputRef, listPrice, setWarningType]);\n}\n_s4(useUpdateInputAndWarnings, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\nexport const getRoyalty = (listingMarket, asset) => {\n  var _asset$basisPoints2;\n  // LooksRare is a unique case where royalties for creators are a flat 0.5% or 50 basis points if royalty is set\n  const baseFee = listingMarket.name === 'LooksRare' ? asset.basisPoints ? LOOKS_RARE_CREATOR_BASIS_POINTS : 0 : (_asset$basisPoints2 = asset.basisPoints) !== null && _asset$basisPoints2 !== void 0 ? _asset$basisPoints2 : 0;\n  return baseFee * 0.01;\n};\n\n// OpenSea has a 0.5% fee for all assets that do not have a royalty set\nexport const getMarketplaceFee = (listingMarket, asset) => {\n  return listingMarket.name === 'OpenSea' && !asset.basisPoints ? 0.5 : listingMarket.fee;\n};\nconst BELOW_FLOOR_PRICE_THRESHOLD = 0.8;\nexport const findListingIssues = sellAssets => {\n  const missingExpiration = sellAssets.some(asset => {\n    return asset.expirationTime != null && (isNaN(asset.expirationTime) || asset.expirationTime * 1000 - Date.now() < 60000);\n  });\n  const overMaxExpiration = sellAssets.some(asset => {\n    return asset.expirationTime != null && asset.expirationTime * 1000 - Date.now() > 15552000000;\n  });\n  const listingsMissingPrice = [];\n  const listingsBelowFloor = [];\n  const listingsAboveSellOrderFloor = [];\n  for (const asset of sellAssets) {\n    if (asset.newListings) {\n      for (const listing of asset.newListings) {\n        var _asset$floorPrice2;\n        if (!listing.price) listingsMissingPrice.push([asset, listing]);else if (listing.price < ((_asset$floorPrice2 = asset === null || asset === void 0 ? void 0 : asset.floorPrice) !== null && _asset$floorPrice2 !== void 0 ? _asset$floorPrice2 : 0) * BELOW_FLOOR_PRICE_THRESHOLD && !listing.overrideFloorPrice) listingsBelowFloor.push([asset, listing]);else if (asset.floor_sell_order_price && listing.price >= asset.floor_sell_order_price && asset.asset_contract.tokenType !== NftStandard.Erc1155) listingsAboveSellOrderFloor.push([asset, listing]);\n      }\n    }\n  }\n  return {\n    missingExpiration,\n    overMaxExpiration,\n    listingsMissingPrice,\n    listingsBelowFloor,\n    listingsAboveSellOrderFloor\n  };\n};","map":{"version":3,"names":["addressesByNetwork","SupportedChainId","NftStandard","SetPriceMethod","WarningType","useNFTList","useSellAsset","LOOKSRARE_MARKETPLACE_CONTRACT_721","LOOKSRARE_MARKETPLACE_CONTRACT_1155","X2Y2_TRANSFER_CONTRACT_721","X2Y2_TRANSFER_CONTRACT_1155","OPENSEA_CROSS_CHAIN_CONDUIT","ListingStatus","approveCollection","LOOKS_RARE_CREATOR_BASIS_POINTS","signListing","useEffect","shallow","approveCollectionRow","collectionRow","signer","setCollectionStatusAndCallback","callback","SIGNING","marketplace","collectionAddress","nftStandard","addresses","MAINNET","spender","name","Erc721","TRANSFER_MANAGER_ERC721","newStatus","signListingRow","listing","provider","getLooksRareNonce","setLooksRareNonce","setListingStatusAndCallback","looksRareNonce","asset","res","getTotalEthValue","sellAssets","total","reduce","newListings","length","maxListing","a","b","price","maxFee","fee","basisPoints","Math","round","Number","EPSILON","getListings","newCollectionsToApprove","forEach","marketplaces","newListing","images","smallImageUrl","icon","tokenId","status","DEFINED","find","push","some","asset_contract","address","newCollectionRow","image_url","isVerified","collectionIsVerified","tokenType","verifyStatus","PAUSED","APPROVED","useSubscribeListingState","state","setListings","setCollectionsRequiringApproval","useHandleGlobalPriceToggle","globalOverride","setListPrice","setPrice","listPrice","globalPrice","useSyncPriceWithGlobalMethod","setGlobalPrice","setGlobalOverride","globalPriceMethod","FLOOR_PRICE","floorPrice","LAST_PRICE","lastPrice","SAME_PRICE","useUpdateInputAndWarnings","setWarningType","inputRef","NONE","current","value","BELOW_FLOOR","floor_sell_order_price","Erc1155","ALREADY_LISTED","getRoyalty","listingMarket","baseFee","getMarketplaceFee","BELOW_FLOOR_PRICE_THRESHOLD","findListingIssues","missingExpiration","expirationTime","isNaN","Date","now","overMaxExpiration","listingsMissingPrice","listingsBelowFloor","listingsAboveSellOrderFloor","overrideFloorPrice"],"sources":["/home/diep/freelance/interface/src/nft/components/profile/list/utils.ts"],"sourcesContent":["import type { JsonRpcSigner, Web3Provider } from '@ethersproject/providers'\nimport { addressesByNetwork, SupportedChainId } from '@looksrare/sdk'\nimport { NftStandard } from 'graphql/data/__generated__/types-and-hooks'\nimport ms from 'ms.macro'\nimport { SetPriceMethod, WarningType } from 'nft/components/profile/list/shared'\nimport { useNFTList, useSellAsset } from 'nft/hooks'\nimport {\n  LOOKSRARE_MARKETPLACE_CONTRACT_721,\n  LOOKSRARE_MARKETPLACE_CONTRACT_1155,\n  X2Y2_TRANSFER_CONTRACT_721,\n  X2Y2_TRANSFER_CONTRACT_1155,\n} from 'nft/queries'\nimport { OPENSEA_CROSS_CHAIN_CONDUIT } from 'nft/queries/openSea'\nimport { CollectionRow, Listing, ListingMarket, ListingRow, ListingStatus, WalletAsset } from 'nft/types'\nimport { approveCollection, LOOKS_RARE_CREATOR_BASIS_POINTS, signListing } from 'nft/utils/listNfts'\nimport { Dispatch, useEffect } from 'react'\nimport { shallow } from 'zustand/shallow'\n\nexport async function approveCollectionRow(\n  collectionRow: CollectionRow,\n  signer: JsonRpcSigner,\n  setCollectionStatusAndCallback: (\n    collection: CollectionRow,\n    status: ListingStatus,\n    callback?: () => Promise<void>\n  ) => void\n) {\n  const callback = () => approveCollectionRow(collectionRow, signer, setCollectionStatusAndCallback)\n  setCollectionStatusAndCallback(collectionRow, ListingStatus.SIGNING, callback)\n  const { marketplace, collectionAddress, nftStandard } = collectionRow\n  const addresses = addressesByNetwork[SupportedChainId.MAINNET]\n  const spender =\n    marketplace.name === 'OpenSea'\n      ? OPENSEA_CROSS_CHAIN_CONDUIT\n      : marketplace.name === 'LooksRare'\n      ? collectionRow.nftStandard === NftStandard.Erc721\n        ? LOOKSRARE_MARKETPLACE_CONTRACT_721\n        : LOOKSRARE_MARKETPLACE_CONTRACT_1155\n      : marketplace.name === 'X2Y2'\n      ? collectionRow.nftStandard === NftStandard.Erc721\n        ? X2Y2_TRANSFER_CONTRACT_721\n        : X2Y2_TRANSFER_CONTRACT_1155\n      : addresses.TRANSFER_MANAGER_ERC721\n  !!collectionAddress &&\n    (await approveCollection(\n      spender,\n      collectionAddress,\n      signer,\n      (newStatus: ListingStatus) => setCollectionStatusAndCallback(collectionRow, newStatus, callback),\n      nftStandard\n    ))\n}\n\nexport async function signListingRow(\n  listing: ListingRow,\n  signer: JsonRpcSigner,\n  provider: Web3Provider,\n  getLooksRareNonce: () => number,\n  setLooksRareNonce: (nonce: number) => void,\n  setListingStatusAndCallback: (listing: ListingRow, status: ListingStatus, callback?: () => Promise<void>) => void\n) {\n  const looksRareNonce = getLooksRareNonce()\n  const callback = () => {\n    return signListingRow(listing, signer, provider, getLooksRareNonce, setLooksRareNonce, setListingStatusAndCallback)\n  }\n  setListingStatusAndCallback(listing, ListingStatus.SIGNING, callback)\n  const { asset, marketplace } = listing\n  const res = await signListing(marketplace, asset, signer, provider, looksRareNonce, (newStatus: ListingStatus) =>\n    setListingStatusAndCallback(listing, newStatus, callback)\n  )\n  res && listing.marketplace.name === 'LooksRare' && setLooksRareNonce(looksRareNonce + 1)\n}\n\nexport const getTotalEthValue = (sellAssets: WalletAsset[]) => {\n  const total = sellAssets.reduce((total, asset: WalletAsset) => {\n    if (asset.newListings?.length) {\n      const maxListing = asset.newListings.reduce((a, b) => ((a.price ?? 0) > (b.price ?? 0) ? a : b))\n      // LooksRare is a unique case where creator royalties are a flat 0.5% or 50 basis points\n      const maxFee =\n        maxListing.marketplace.fee +\n        (maxListing.marketplace.name === 'LooksRare' ? LOOKS_RARE_CREATOR_BASIS_POINTS : asset?.basisPoints ?? 0) / 100\n      return total + (maxListing.price ?? 0) - (maxListing.price ?? 0) * (maxFee / 100)\n    }\n    return total\n  }, 0)\n  return total ? Math.round(total * 10000 + Number.EPSILON) / 10000 : 0\n}\n\nconst getListings = (sellAssets: WalletAsset[]): [CollectionRow[], ListingRow[]] => {\n  const newCollectionsToApprove: CollectionRow[] = []\n\n  const newListings: ListingRow[] = []\n  sellAssets.forEach((asset) => {\n    asset.marketplaces?.forEach((marketplace: ListingMarket) => {\n      const newListing = {\n        images: [asset.smallImageUrl, marketplace.icon],\n        name: asset.name || `#${asset.tokenId}`,\n        status: ListingStatus.DEFINED,\n        asset,\n        marketplace,\n        price: asset.newListings?.find((listing) => listing.marketplace.name === marketplace.name)?.price,\n      }\n      newListings.push(newListing)\n      if (\n        !newCollectionsToApprove.some(\n          (collectionRow: CollectionRow) =>\n            collectionRow.collectionAddress === asset.asset_contract.address &&\n            collectionRow.marketplace.name === marketplace.name\n        )\n      ) {\n        const newCollectionRow = {\n          images: [asset.asset_contract.image_url, marketplace.icon],\n          name: asset.asset_contract.name,\n          status: ListingStatus.DEFINED,\n          collectionAddress: asset.asset_contract.address,\n          isVerified: asset.collectionIsVerified,\n          marketplace,\n          nftStandard: asset.asset_contract.tokenType,\n        }\n        newCollectionsToApprove.push(newCollectionRow)\n      }\n    })\n  })\n  return [newCollectionsToApprove, newListings]\n}\n\nexport const verifyStatus = (status: ListingStatus) => {\n  return status !== ListingStatus.PAUSED && status !== ListingStatus.APPROVED\n}\n\nexport function useSubscribeListingState() {\n  const sellAssets = useSellAsset((state) => state.sellAssets)\n  const { setListings, setCollectionsRequiringApproval } = useNFTList(\n    ({ setListings, setCollectionsRequiringApproval }) => ({\n      setListings,\n      setCollectionsRequiringApproval,\n    }),\n    shallow\n  )\n  useEffect(() => {\n    const [newCollectionsToApprove, newListings] = getListings(sellAssets)\n    setListings(newListings)\n    setCollectionsRequiringApproval(newCollectionsToApprove)\n  }, [sellAssets, setCollectionsRequiringApproval, setListings])\n}\n\nexport function useHandleGlobalPriceToggle(\n  globalOverride: boolean,\n  setListPrice: Dispatch<number | undefined>,\n  setPrice: (price?: number) => void,\n  listPrice?: number,\n  globalPrice?: number\n) {\n  useEffect(() => {\n    let price: number | undefined\n    if (globalOverride) {\n      if (!listPrice) setListPrice(globalPrice)\n      price = globalPrice\n    } else {\n      price = listPrice\n    }\n    setPrice(price)\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [globalOverride])\n}\n\nexport function useSyncPriceWithGlobalMethod(\n  asset: WalletAsset,\n  setListPrice: Dispatch<number | undefined>,\n  setGlobalPrice: Dispatch<number | undefined>,\n  setGlobalOverride: Dispatch<boolean>,\n  listPrice?: number,\n  globalPrice?: number,\n  globalPriceMethod?: SetPriceMethod\n) {\n  useEffect(() => {\n    if (globalPriceMethod === SetPriceMethod.FLOOR_PRICE) {\n      setListPrice(asset?.floorPrice)\n      setGlobalPrice(asset.floorPrice)\n    } else if (globalPriceMethod === SetPriceMethod.LAST_PRICE) {\n      setListPrice(asset.lastPrice)\n      setGlobalPrice(asset.lastPrice)\n    } else if (globalPriceMethod === SetPriceMethod.SAME_PRICE)\n      listPrice && !globalPrice ? setGlobalPrice(listPrice) : setListPrice(globalPrice)\n\n    setGlobalOverride(false)\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [globalPriceMethod])\n}\n\nexport function useUpdateInputAndWarnings(\n  setWarningType: Dispatch<WarningType>,\n  inputRef: React.MutableRefObject<HTMLInputElement>,\n  asset: WalletAsset,\n  listPrice?: number\n) {\n  useEffect(() => {\n    setWarningType(WarningType.NONE)\n    const price = listPrice ?? 0\n    inputRef.current.value = `${price}`\n    if (price < (asset?.floorPrice ?? 0) && price > 0) setWarningType(WarningType.BELOW_FLOOR)\n    else if (\n      asset.floor_sell_order_price &&\n      price >= asset.floor_sell_order_price &&\n      asset.asset_contract.tokenType !== NftStandard.Erc1155\n    )\n      setWarningType(WarningType.ALREADY_LISTED)\n  }, [\n    asset.asset_contract.tokenType,\n    asset?.floorPrice,\n    asset.floor_sell_order_price,\n    inputRef,\n    listPrice,\n    setWarningType,\n  ])\n}\n\nexport const getRoyalty = (listingMarket: ListingMarket, asset: WalletAsset) => {\n  // LooksRare is a unique case where royalties for creators are a flat 0.5% or 50 basis points if royalty is set\n  const baseFee =\n    listingMarket.name === 'LooksRare'\n      ? asset.basisPoints\n        ? LOOKS_RARE_CREATOR_BASIS_POINTS\n        : 0\n      : asset.basisPoints ?? 0\n\n  return baseFee * 0.01\n}\n\n// OpenSea has a 0.5% fee for all assets that do not have a royalty set\nexport const getMarketplaceFee = (listingMarket: ListingMarket, asset: WalletAsset) => {\n  return listingMarket.name === 'OpenSea' && !asset.basisPoints ? 0.5 : listingMarket.fee\n}\n\nconst BELOW_FLOOR_PRICE_THRESHOLD = 0.8\n\nexport const findListingIssues = (sellAssets: WalletAsset[]) => {\n  const missingExpiration = sellAssets.some((asset) => {\n    return (\n      asset.expirationTime != null &&\n      (isNaN(asset.expirationTime) || asset.expirationTime * 1000 - Date.now() < ms`60 seconds`)\n    )\n  })\n  const overMaxExpiration = sellAssets.some((asset) => {\n    return asset.expirationTime != null && asset.expirationTime * 1000 - Date.now() > ms`180 days`\n  })\n\n  const listingsMissingPrice: [WalletAsset, Listing][] = []\n  const listingsBelowFloor: [WalletAsset, Listing][] = []\n  const listingsAboveSellOrderFloor: [WalletAsset, Listing][] = []\n  for (const asset of sellAssets) {\n    if (asset.newListings) {\n      for (const listing of asset.newListings) {\n        if (!listing.price) listingsMissingPrice.push([asset, listing])\n        else if (listing.price < (asset?.floorPrice ?? 0) * BELOW_FLOOR_PRICE_THRESHOLD && !listing.overrideFloorPrice)\n          listingsBelowFloor.push([asset, listing])\n        else if (\n          asset.floor_sell_order_price &&\n          listing.price >= asset.floor_sell_order_price &&\n          asset.asset_contract.tokenType !== NftStandard.Erc1155\n        )\n          listingsAboveSellOrderFloor.push([asset, listing])\n      }\n    }\n  }\n  return {\n    missingExpiration,\n    overMaxExpiration,\n    listingsMissingPrice,\n    listingsBelowFloor,\n    listingsAboveSellOrderFloor,\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}