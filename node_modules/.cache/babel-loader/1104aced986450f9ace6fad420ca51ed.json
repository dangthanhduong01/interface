{"ast":null,"code":"import { sendAnalyticsEvent } from '@uniswap/analytics';\nimport { URI_AVAILABLE, WalletConnect } from '@web3-react/walletconnect';\nimport { isIOS } from 'utils/userAgent';\nimport { RPC_URLS } from '../constants/networks';\n\n// Avoid testing for the best URL by only passing a single URL per chain.\n// Otherwise, WC will not initialize until all URLs have been tested (see getBestUrl in web3-react).\nconst RPC_URLS_WITHOUT_FALLBACKS = Object.entries(RPC_URLS).reduce(_c = (map, _ref) => {\n  let [chainId, urls] = _ref;\n  return {\n    ...map,\n    [chainId]: urls[0]\n  };\n}, {});\n_c2 = RPC_URLS_WITHOUT_FALLBACKS;\nexport class WalletConnectPopup extends WalletConnect {\n  constructor(_ref2) {\n    let {\n      actions,\n      onError,\n      qrcode = true\n    } = _ref2;\n    super({\n      actions,\n      options: {\n        qrcode,\n        rpc: RPC_URLS_WITHOUT_FALLBACKS\n      },\n      onError\n    });\n    this.ANALYTICS_EVENT = 'Wallet Connect QR Scan';\n  }\n  activate(chainId) {\n    sendAnalyticsEvent(this.ANALYTICS_EVENT);\n    return super.activate(chainId);\n  }\n}\n\n// Custom class for Uniswap Wallet specific functionality\nexport class UniwalletConnect extends WalletConnectPopup {\n  constructor(_ref3) {\n    let {\n      actions,\n      onError\n    } = _ref3;\n    // disables walletconnect's proprietary qr code modal; instead UniwalletModal will listen for events to trigger our custom modal\n    super({\n      actions,\n      qrcode: false,\n      onError\n    });\n    this.ANALYTICS_EVENT = 'Uniswap Wallet QR Scan';\n    this.events.once(URI_AVAILABLE, () => {\n      var _this$provider;\n      (_this$provider = this.provider) === null || _this$provider === void 0 ? void 0 : _this$provider.connector.on('disconnect', () => {\n        this.deactivate();\n      });\n    });\n    this.events.on(URI_AVAILABLE, uri => {\n      if (!uri) return;\n      // Emits custom wallet connect code, parseable by the Uniswap Wallet\n      this.events.emit(UniwalletConnect.UNI_URI_AVAILABLE, `hello_uniwallet:${uri}`);\n\n      // Opens deeplink to Uniswap Wallet if on iOS\n      if (isIOS) {\n        const newTab = window.open(`https://uniswap.org/app/wc?uri=${encodeURIComponent(uri)}`);\n\n        // Fixes blank tab opening on mobile Chrome\n        newTab === null || newTab === void 0 ? void 0 : newTab.close();\n      }\n    });\n  }\n  deactivate() {\n    this.events.emit(URI_AVAILABLE);\n    return super.deactivate();\n  }\n}\nUniwalletConnect.UNI_URI_AVAILABLE = 'uni_uri_available';\nvar _c, _c2;\n$RefreshReg$(_c, \"RPC_URLS_WITHOUT_FALLBACKS$Object.entries(RPC_URLS).reduce\");\n$RefreshReg$(_c2, \"RPC_URLS_WITHOUT_FALLBACKS\");","map":{"version":3,"names":["sendAnalyticsEvent","URI_AVAILABLE","WalletConnect","isIOS","RPC_URLS","RPC_URLS_WITHOUT_FALLBACKS","Object","entries","reduce","map","chainId","urls","WalletConnectPopup","constructor","actions","onError","qrcode","options","rpc","ANALYTICS_EVENT","activate","UniwalletConnect","events","once","provider","connector","on","deactivate","uri","emit","UNI_URI_AVAILABLE","newTab","window","open","encodeURIComponent","close"],"sources":["/home/diep/freelance/interface/src/connection/WalletConnect.ts"],"sourcesContent":["import { sendAnalyticsEvent } from '@uniswap/analytics'\nimport { URI_AVAILABLE, WalletConnect, WalletConnectConstructorArgs } from '@web3-react/walletconnect'\nimport { isIOS } from 'utils/userAgent'\n\nimport { RPC_URLS } from '../constants/networks'\n\n// Avoid testing for the best URL by only passing a single URL per chain.\n// Otherwise, WC will not initialize until all URLs have been tested (see getBestUrl in web3-react).\nconst RPC_URLS_WITHOUT_FALLBACKS = Object.entries(RPC_URLS).reduce(\n  (map, [chainId, urls]) => ({\n    ...map,\n    [chainId]: urls[0],\n  }),\n  {}\n)\n\nexport class WalletConnectPopup extends WalletConnect {\n  ANALYTICS_EVENT = 'Wallet Connect QR Scan'\n  constructor({\n    actions,\n    onError,\n    qrcode = true,\n  }: Omit<WalletConnectConstructorArgs, 'options'> & { qrcode?: boolean }) {\n    super({ actions, options: { qrcode, rpc: RPC_URLS_WITHOUT_FALLBACKS }, onError })\n  }\n\n  activate(chainId?: number) {\n    sendAnalyticsEvent(this.ANALYTICS_EVENT)\n    return super.activate(chainId)\n  }\n}\n\n// Custom class for Uniswap Wallet specific functionality\nexport class UniwalletConnect extends WalletConnectPopup {\n  ANALYTICS_EVENT = 'Uniswap Wallet QR Scan'\n  static UNI_URI_AVAILABLE = 'uni_uri_available'\n\n  constructor({ actions, onError }: Omit<WalletConnectConstructorArgs, 'options'>) {\n    // disables walletconnect's proprietary qr code modal; instead UniwalletModal will listen for events to trigger our custom modal\n    super({ actions, qrcode: false, onError })\n\n    this.events.once(URI_AVAILABLE, () => {\n      this.provider?.connector.on('disconnect', () => {\n        this.deactivate()\n      })\n    })\n\n    this.events.on(URI_AVAILABLE, (uri) => {\n      if (!uri) return\n      // Emits custom wallet connect code, parseable by the Uniswap Wallet\n      this.events.emit(UniwalletConnect.UNI_URI_AVAILABLE, `hello_uniwallet:${uri}`)\n\n      // Opens deeplink to Uniswap Wallet if on iOS\n      if (isIOS) {\n        const newTab = window.open(`https://uniswap.org/app/wc?uri=${encodeURIComponent(uri)}`)\n\n        // Fixes blank tab opening on mobile Chrome\n        newTab?.close()\n      }\n    })\n  }\n\n  deactivate() {\n    this.events.emit(URI_AVAILABLE)\n    return super.deactivate()\n  }\n}\n"],"mappings":"AAAA,SAASA,kBAAkB,QAAQ,oBAAoB;AACvD,SAASC,aAAa,EAAEC,aAAa,QAAsC,2BAA2B;AACtG,SAASC,KAAK,QAAQ,iBAAiB;AAEvC,SAASC,QAAQ,QAAQ,uBAAuB;;AAEhD;AACA;AACA,MAAMC,0BAA0B,GAAGC,MAAM,CAACC,OAAO,CAACH,QAAQ,CAAC,CAACI,MAAM,MAChE,CAACC,GAAG;EAAA,IAAE,CAACC,OAAO,EAAEC,IAAI,CAAC;EAAA,OAAM;IACzB,GAAGF,GAAG;IACN,CAACC,OAAO,GAAGC,IAAI,CAAC,CAAC;EACnB,CAAC;AAAA,CAAC,EACF,CAAC,CAAC,CACH;AAAA,MANKN,0BAA0B;AAQhC,OAAO,MAAMO,kBAAkB,SAASV,aAAa,CAAC;EAEpDW,WAAW,QAI8D;IAAA,IAJ7D;MACVC,OAAO;MACPC,OAAO;MACPC,MAAM,GAAG;IAC2D,CAAC;IACrE,KAAK,CAAC;MAAEF,OAAO;MAAEG,OAAO,EAAE;QAAED,MAAM;QAAEE,GAAG,EAAEb;MAA2B,CAAC;MAAEU;IAAQ,CAAC,CAAC;IAAA,KANnFI,eAAe,GAAG,wBAAwB;EAO1C;EAEAC,QAAQ,CAACV,OAAgB,EAAE;IACzBV,kBAAkB,CAAC,IAAI,CAACmB,eAAe,CAAC;IACxC,OAAO,KAAK,CAACC,QAAQ,CAACV,OAAO,CAAC;EAChC;AACF;;AAEA;AACA,OAAO,MAAMW,gBAAgB,SAAST,kBAAkB,CAAC;EAIvDC,WAAW,QAAsE;IAAA,IAArE;MAAEC,OAAO;MAAEC;IAAuD,CAAC;IAC7E;IACA,KAAK,CAAC;MAAED,OAAO;MAAEE,MAAM,EAAE,KAAK;MAAED;IAAQ,CAAC,CAAC;IAAA,KAL5CI,eAAe,GAAG,wBAAwB;IAOxC,IAAI,CAACG,MAAM,CAACC,IAAI,CAACtB,aAAa,EAAE,MAAM;MAAA;MACpC,sBAAI,CAACuB,QAAQ,mDAAb,eAAeC,SAAS,CAACC,EAAE,CAAC,YAAY,EAAE,MAAM;QAC9C,IAAI,CAACC,UAAU,EAAE;MACnB,CAAC,CAAC;IACJ,CAAC,CAAC;IAEF,IAAI,CAACL,MAAM,CAACI,EAAE,CAACzB,aAAa,EAAG2B,GAAG,IAAK;MACrC,IAAI,CAACA,GAAG,EAAE;MACV;MACA,IAAI,CAACN,MAAM,CAACO,IAAI,CAACR,gBAAgB,CAACS,iBAAiB,EAAG,mBAAkBF,GAAI,EAAC,CAAC;;MAE9E;MACA,IAAIzB,KAAK,EAAE;QACT,MAAM4B,MAAM,GAAGC,MAAM,CAACC,IAAI,CAAE,kCAAiCC,kBAAkB,CAACN,GAAG,CAAE,EAAC,CAAC;;QAEvF;QACAG,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEI,KAAK,EAAE;MACjB;IACF,CAAC,CAAC;EACJ;EAEAR,UAAU,GAAG;IACX,IAAI,CAACL,MAAM,CAACO,IAAI,CAAC5B,aAAa,CAAC;IAC/B,OAAO,KAAK,CAAC0B,UAAU,EAAE;EAC3B;AACF;AAjCaN,gBAAgB,CAEpBS,iBAAiB,GAAG,mBAAmB;AAAA;AAAA;AAAA"},"metadata":{},"sourceType":"module"}