{"ast":null,"code":"import { Pair } from '@uniswap/v2-sdk';\nimport { Pool } from '@uniswap/v3-sdk';\nimport { log } from '../../../util/log';\nimport { poolToString, routeToString } from '../../../util/routes';\nimport { MixedRoute, V2Route, V3Route } from '../../router';\nexport function computeAllV3Routes(tokenIn, tokenOut, pools, maxHops) {\n  return computeAllRoutes(tokenIn, tokenOut, (route, tokenIn, tokenOut) => {\n    return new V3Route(route, tokenIn, tokenOut);\n  }, pools, maxHops);\n}\nexport function computeAllV2Routes(tokenIn, tokenOut, pools, maxHops) {\n  return computeAllRoutes(tokenIn, tokenOut, (route, tokenIn, tokenOut) => {\n    return new V2Route(route, tokenIn, tokenOut);\n  }, pools, maxHops);\n}\nexport function computeAllMixedRoutes(tokenIn, tokenOut, parts, maxHops) {\n  const routesRaw = computeAllRoutes(tokenIn, tokenOut, (route, tokenIn, tokenOut) => {\n    return new MixedRoute(route, tokenIn, tokenOut);\n  }, parts, maxHops);\n  /// filter out pure v3 and v2 routes\n  return routesRaw.filter(route => {\n    return !route.pools.every(pool => pool instanceof Pool) && !route.pools.every(pool => pool instanceof Pair);\n  });\n}\nexport function computeAllRoutes(tokenIn, tokenOut, buildRoute, pools, maxHops) {\n  var _a;\n  const poolsUsed = Array(pools.length).fill(false);\n  const routes = [];\n  const computeRoutes = (tokenIn, tokenOut, currentRoute, poolsUsed, _previousTokenOut) => {\n    if (currentRoute.length > maxHops) {\n      return;\n    }\n    if (currentRoute.length > 0 && currentRoute[currentRoute.length - 1].involvesToken(tokenOut)) {\n      routes.push(buildRoute([...currentRoute], tokenIn, tokenOut));\n      return;\n    }\n    for (let i = 0; i < pools.length; i++) {\n      if (poolsUsed[i]) {\n        continue;\n      }\n      const curPool = pools[i];\n      const previousTokenOut = _previousTokenOut ? _previousTokenOut : tokenIn;\n      if (!curPool.involvesToken(previousTokenOut)) {\n        continue;\n      }\n      const currentTokenOut = curPool.token0.equals(previousTokenOut) ? curPool.token1 : curPool.token0;\n      currentRoute.push(curPool);\n      poolsUsed[i] = true;\n      computeRoutes(tokenIn, tokenOut, currentRoute, poolsUsed, currentTokenOut);\n      poolsUsed[i] = false;\n      currentRoute.pop();\n    }\n  };\n  computeRoutes(tokenIn, tokenOut, [], poolsUsed);\n  log.info({\n    routes: routes.map(routeToString),\n    pools: pools.map(poolToString)\n  }, `Computed ${routes.length} possible routes for type ${(_a = routes[0]) === null || _a === void 0 ? void 0 : _a.protocol}.`);\n  return routes;\n}","map":{"version":3,"sources":["../../../../../src/routers/alpha-router/functions/compute-all-routes.ts"],"names":[],"mappings":"AACA,SAAS,IAAI,QAAQ,iBAAiB;AACtC,SAAS,IAAI,QAAQ,iBAAiB;AAEtC,SAAS,GAAG,QAAQ,mBAAmB;AACvC,SAAS,YAAY,EAAE,aAAa,QAAQ,sBAAsB;AAClE,SAAS,UAAU,EAAE,OAAO,EAAE,OAAO,QAAQ,cAAc;AAE3D,OAAM,SAAU,kBAAkB,CAChC,OAAc,EACd,QAAe,EACf,KAAa,EACb,OAAe,EAAA;EAEf,OAAO,gBAAgB,CACrB,OAAO,EACP,QAAQ,EACR,CAAC,KAAa,EAAE,OAAc,EAAE,QAAe,KAAI;IACjD,OAAO,IAAI,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,QAAQ,CAAC;EAC9C,CAAC,EACD,KAAK,EACL,OAAO,CACR;AACH;AAEA,OAAM,SAAU,kBAAkB,CAChC,OAAc,EACd,QAAe,EACf,KAAa,EACb,OAAe,EAAA;EAEf,OAAO,gBAAgB,CACrB,OAAO,EACP,QAAQ,EACR,CAAC,KAAa,EAAE,OAAc,EAAE,QAAe,KAAI;IACjD,OAAO,IAAI,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,QAAQ,CAAC;EAC9C,CAAC,EACD,KAAK,EACL,OAAO,CACR;AACH;AAEA,OAAM,SAAU,qBAAqB,CACnC,OAAc,EACd,QAAe,EACf,KAAsB,EACtB,OAAe,EAAA;EAEf,MAAM,SAAS,GAAG,gBAAgB,CAChC,OAAO,EACP,QAAQ,EACR,CAAC,KAAsB,EAAE,OAAc,EAAE,QAAe,KAAI;IAC1D,OAAO,IAAI,UAAU,CAAC,KAAK,EAAE,OAAO,EAAE,QAAQ,CAAC;EACjD,CAAC,EACD,KAAK,EACL,OAAO,CACR;EACD;EACA,OAAO,SAAS,CAAC,MAAM,CAAE,KAAK,IAAI;IAChC,OACE,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAE,IAAI,IAAK,IAAI,YAAY,IAAI,CAAC,IAClD,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAE,IAAI,IAAK,IAAI,YAAY,IAAI,CAAC;EAEtD,CAAC,CAAC;AACJ;AAEA,OAAM,SAAU,gBAAgB,CAI9B,OAAc,EACd,QAAe,EACf,UAAuE,EACvE,KAAc,EACd,OAAe,EAAA;;EAEf,MAAM,SAAS,GAAG,KAAK,CAAU,KAAK,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC;EAC1D,MAAM,MAAM,GAAa,EAAE;EAE3B,MAAM,aAAa,GAAG,CACpB,OAAc,EACd,QAAe,EACf,YAAqB,EACrB,SAAoB,EACpB,iBAAyB,KACvB;IACF,IAAI,YAAY,CAAC,MAAM,GAAG,OAAO,EAAE;MACjC;IACD;IAED,IACE,YAAY,CAAC,MAAM,GAAG,CAAC,IACvB,YAAY,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAE,CAAC,aAAa,CAAC,QAAQ,CAAC,EAC9D;MACA,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,YAAY,CAAC,EAAE,OAAO,EAAE,QAAQ,CAAC,CAAC;MAC7D;IACD;IAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;MACrC,IAAI,SAAS,CAAC,CAAC,CAAC,EAAE;QAChB;MACD;MAED,MAAM,OAAO,GAAG,KAAK,CAAC,CAAC,CAAE;MACzB,MAAM,gBAAgB,GAAG,iBAAiB,GAAG,iBAAiB,GAAG,OAAO;MAExE,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,gBAAgB,CAAC,EAAE;QAC5C;MACD;MAED,MAAM,eAAe,GAAG,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,gBAAgB,CAAC,GAC3D,OAAO,CAAC,MAAM,GACd,OAAO,CAAC,MAAM;MAElB,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC;MAC1B,SAAS,CAAC,CAAC,CAAC,GAAG,IAAI;MACnB,aAAa,CACX,OAAO,EACP,QAAQ,EACR,YAAY,EACZ,SAAS,EACT,eAAe,CAChB;MACD,SAAS,CAAC,CAAC,CAAC,GAAG,KAAK;MACpB,YAAY,CAAC,GAAG,EAAE;IACnB;EACH,CAAC;EAED,aAAa,CAAC,OAAO,EAAE,QAAQ,EAAE,EAAE,EAAE,SAAS,CAAC;EAE/C,GAAG,CAAC,IAAI,CACN;IACE,MAAM,EAAE,MAAM,CAAC,GAAG,CAAC,aAAa,CAAC;IACjC,KAAK,EAAE,KAAK,CAAC,GAAG,CAAC,YAAY;GAC9B,EACD,YAAY,MAAM,CAAC,MAAM,6BAA6B,CAAA,EAAA,GAAA,MAAM,CAAC,CAAC,CAAC,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAE,QAAQ,GAAG,CAC7E;EAED,OAAO,MAAM;AACf","sourceRoot":"","sourcesContent":["import { Pair } from '@uniswap/v2-sdk';\nimport { Pool } from '@uniswap/v3-sdk';\nimport { log } from '../../../util/log';\nimport { poolToString, routeToString } from '../../../util/routes';\nimport { MixedRoute, V2Route, V3Route } from '../../router';\nexport function computeAllV3Routes(tokenIn, tokenOut, pools, maxHops) {\n    return computeAllRoutes(tokenIn, tokenOut, (route, tokenIn, tokenOut) => {\n        return new V3Route(route, tokenIn, tokenOut);\n    }, pools, maxHops);\n}\nexport function computeAllV2Routes(tokenIn, tokenOut, pools, maxHops) {\n    return computeAllRoutes(tokenIn, tokenOut, (route, tokenIn, tokenOut) => {\n        return new V2Route(route, tokenIn, tokenOut);\n    }, pools, maxHops);\n}\nexport function computeAllMixedRoutes(tokenIn, tokenOut, parts, maxHops) {\n    const routesRaw = computeAllRoutes(tokenIn, tokenOut, (route, tokenIn, tokenOut) => {\n        return new MixedRoute(route, tokenIn, tokenOut);\n    }, parts, maxHops);\n    /// filter out pure v3 and v2 routes\n    return routesRaw.filter((route) => {\n        return (!route.pools.every((pool) => pool instanceof Pool) &&\n            !route.pools.every((pool) => pool instanceof Pair));\n    });\n}\nexport function computeAllRoutes(tokenIn, tokenOut, buildRoute, pools, maxHops) {\n    var _a;\n    const poolsUsed = Array(pools.length).fill(false);\n    const routes = [];\n    const computeRoutes = (tokenIn, tokenOut, currentRoute, poolsUsed, _previousTokenOut) => {\n        if (currentRoute.length > maxHops) {\n            return;\n        }\n        if (currentRoute.length > 0 &&\n            currentRoute[currentRoute.length - 1].involvesToken(tokenOut)) {\n            routes.push(buildRoute([...currentRoute], tokenIn, tokenOut));\n            return;\n        }\n        for (let i = 0; i < pools.length; i++) {\n            if (poolsUsed[i]) {\n                continue;\n            }\n            const curPool = pools[i];\n            const previousTokenOut = _previousTokenOut ? _previousTokenOut : tokenIn;\n            if (!curPool.involvesToken(previousTokenOut)) {\n                continue;\n            }\n            const currentTokenOut = curPool.token0.equals(previousTokenOut)\n                ? curPool.token1\n                : curPool.token0;\n            currentRoute.push(curPool);\n            poolsUsed[i] = true;\n            computeRoutes(tokenIn, tokenOut, currentRoute, poolsUsed, currentTokenOut);\n            poolsUsed[i] = false;\n            currentRoute.pop();\n        }\n    };\n    computeRoutes(tokenIn, tokenOut, [], poolsUsed);\n    log.info({\n        routes: routes.map(routeToString),\n        pools: pools.map(poolToString),\n    }, `Computed ${routes.length} possible routes for type ${(_a = routes[0]) === null || _a === void 0 ? void 0 : _a.protocol}.`);\n    return routes;\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcHV0ZS1hbGwtcm91dGVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL3JvdXRlcnMvYWxwaGEtcm91dGVyL2Z1bmN0aW9ucy9jb21wdXRlLWFsbC1yb3V0ZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV2QyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDeEMsT0FBTyxFQUFFLFlBQVksRUFBRSxhQUFhLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNuRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFNUQsTUFBTSxVQUFVLGtCQUFrQixDQUNoQyxPQUFjLEVBQ2QsUUFBZSxFQUNmLEtBQWEsRUFDYixPQUFlO0lBRWYsT0FBTyxnQkFBZ0IsQ0FDckIsT0FBTyxFQUNQLFFBQVEsRUFDUixDQUFDLEtBQWEsRUFBRSxPQUFjLEVBQUUsUUFBZSxFQUFFLEVBQUU7UUFDakQsT0FBTyxJQUFJLE9BQU8sQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQy9DLENBQUMsRUFDRCxLQUFLLEVBQ0wsT0FBTyxDQUNSLENBQUM7QUFDSixDQUFDO0FBRUQsTUFBTSxVQUFVLGtCQUFrQixDQUNoQyxPQUFjLEVBQ2QsUUFBZSxFQUNmLEtBQWEsRUFDYixPQUFlO0lBRWYsT0FBTyxnQkFBZ0IsQ0FDckIsT0FBTyxFQUNQLFFBQVEsRUFDUixDQUFDLEtBQWEsRUFBRSxPQUFjLEVBQUUsUUFBZSxFQUFFLEVBQUU7UUFDakQsT0FBTyxJQUFJLE9BQU8sQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQy9DLENBQUMsRUFDRCxLQUFLLEVB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"]},"metadata":{},"sourceType":"module"}