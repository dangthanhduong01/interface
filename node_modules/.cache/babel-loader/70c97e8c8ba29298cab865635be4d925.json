{"ast":null,"code":"import { BigNumber } from '@ethersproject/bignumber';\nimport { BagItemStatus, isPooledMarket, Markets } from 'nft/types';\nimport { isInSameMarketplaceCollection, isInSameSudoSwapPool } from 'nft/utils';\nconst PRECISION = '1000000000000000000';\nconst PROTOCOL_FEE_MULTIPLIER = BigNumber.from('5000000000000000');\nvar BondingCurve;\n(function (BondingCurve) {\n  BondingCurve[\"Linear\"] = \"LINEAR\";\n  BondingCurve[\"Exponential\"] = \"EXPONENTIAL\";\n  BondingCurve[\"Xyk\"] = \"XYK\";\n})(BondingCurve || (BondingCurve = {}));\nconst getPoolParameters = protocolParameters => {\n  var _poolMetadata, _poolMetadata2;\n  return {\n    delta: (protocolParameters === null || protocolParameters === void 0 ? void 0 : protocolParameters.delta) ? protocolParameters.delta : undefined,\n    fee: (protocolParameters === null || protocolParameters === void 0 ? void 0 : protocolParameters.ammFeeFixed) ? protocolParameters.ammFeeFixed : undefined,\n    spotPrice: protocolParameters === null || protocolParameters === void 0 ? void 0 : (_poolMetadata = protocolParameters.poolMetadata) === null || _poolMetadata === void 0 ? void 0 : _poolMetadata.spotPrice,\n    bondingCurve: protocolParameters === null || protocolParameters === void 0 ? void 0 : (_poolMetadata2 = protocolParameters.poolMetadata) === null || _poolMetadata2 === void 0 ? void 0 : _poolMetadata2.bondingCurve\n  };\n};\nconst calculateScaledPrice = (currentPrice, poolFee) => {\n  const protocolFee = currentPrice.mul(PROTOCOL_FEE_MULTIPLIER).div(BigNumber.from(PRECISION));\n  const tradeFee = currentPrice.mul(poolFee).div(BigNumber.from(PRECISION));\n  return currentPrice.add(protocolFee).add(tradeFee);\n};\nconst calcSudoSwapLinearBondingCurve = function (currentPrice, delta) {\n  let position = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  for (let i = 0; i <= position; i++) {\n    currentPrice = currentPrice.add(delta);\n  }\n  return currentPrice;\n};\nconst calcSudoSwapExponentialBondingCurve = function (currentPrice, delta) {\n  let position = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  for (let i = 0; i <= position; i++) {\n    currentPrice = currentPrice.mul(delta).div(BigNumber.from(PRECISION));\n  }\n  return currentPrice;\n};\nconst calcSudoSwapXykBondingCurve = function (currentPrice, sudoSwapPool) {\n  let position = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  let virtualTokenBalance = BigNumber.from(sudoSwapPool.spotPrice);\n  let virtualNFTBalance = BigNumber.from(sudoSwapPool.delta);\n  if (virtualNFTBalance.sub(BigNumber.from(1)).gt(BigNumber.from(0))) {\n    currentPrice = virtualTokenBalance.div(virtualNFTBalance.sub(BigNumber.from(1)));\n  } else {\n    return undefined;\n  }\n  for (let i = 1; i <= position; i++) {\n    virtualTokenBalance = virtualTokenBalance.add(currentPrice);\n    virtualNFTBalance = virtualNFTBalance.sub(BigNumber.from(1));\n    if (!virtualNFTBalance.sub(BigNumber.from(1)).isZero()) {\n      currentPrice = virtualTokenBalance.div(virtualNFTBalance.sub(BigNumber.from(1)));\n    } else {\n      return undefined;\n    }\n  }\n  return currentPrice;\n};\nexport const calcSudoSwapPrice = function (asset) {\n  let position = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  if (!asset.sellorders) return undefined;\n  const sudoSwapParameters = asset.sellorders[0].protocolParameters;\n  const sudoSwapPool = getPoolParameters(sudoSwapParameters);\n  if (!sudoSwapPool.fee || !sudoSwapPool.delta || !sudoSwapPool.spotPrice || !sudoSwapPool.bondingCurve) return undefined;\n  let currentPrice = BigNumber.from(sudoSwapPool.spotPrice);\n  const delta = BigNumber.from(sudoSwapPool.delta);\n  const poolFee = BigNumber.from(sudoSwapPool.fee);\n  if (sudoSwapPool.bondingCurve === BondingCurve.Linear) {\n    currentPrice = calcSudoSwapLinearBondingCurve(currentPrice, delta, position);\n  } else if (sudoSwapPool.bondingCurve === BondingCurve.Exponential) {\n    currentPrice = calcSudoSwapExponentialBondingCurve(currentPrice, delta, position);\n  } else if (sudoSwapPool.bondingCurve === BondingCurve.Xyk) {\n    const xykCurrentPrice = calcSudoSwapXykBondingCurve(currentPrice, sudoSwapPool, position);\n    if (xykCurrentPrice) {\n      currentPrice = xykCurrentPrice;\n    } else {\n      return undefined;\n    }\n  } else {\n    return undefined;\n  }\n  return calculateScaledPrice(currentPrice, poolFee).toString();\n};\nconst calcAmmBasedPoolprice = function (asset) {\n  var _poolMetadata$ethRese, _poolMetadata3, _poolMetadata3$ethRes, _poolMetadata$tokenRe, _poolMetadata4, _poolMetadata4$tokenR;\n  let position = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  if (!asset.sellorders) return '';\n  let amountToBuy = BigNumber.from(0);\n  let marginalBuy = BigNumber.from(0);\n  const nft = asset.sellorders[0].protocolParameters;\n  const decimals = BigNumber.from(1).mul(10).pow(18);\n  const ammFee = (nft === null || nft === void 0 ? void 0 : nft.ammFeePercent) ? (100 + nft.ammFeePercent) * 100 : 110 * 100;\n  if (asset.marketplace === Markets.NFTX) {\n    const sixteenmul = BigNumber.from(1).mul(10).pow(16);\n    amountToBuy = BigNumber.from(ammFee).div(100).mul(position + 1);\n    amountToBuy = amountToBuy.mul(sixteenmul);\n    marginalBuy = BigNumber.from(ammFee).div(100).mul(position);\n    marginalBuy = marginalBuy.mul(sixteenmul);\n  }\n  if (asset.marketplace === Markets.NFT20) {\n    amountToBuy = BigNumber.from(100).mul(position + 1);\n    amountToBuy = amountToBuy.mul(decimals);\n    marginalBuy = BigNumber.from(100).mul(position);\n    marginalBuy = marginalBuy.mul(decimals);\n  }\n  const ethReserves = BigNumber.from((_poolMetadata$ethRese = nft === null || nft === void 0 ? void 0 : (_poolMetadata3 = nft.poolMetadata) === null || _poolMetadata3 === void 0 ? void 0 : (_poolMetadata3$ethRes = _poolMetadata3.ethReserves) === null || _poolMetadata3$ethRes === void 0 ? void 0 : _poolMetadata3$ethRes.toLocaleString('fullwide', {\n    useGrouping: false\n  })) !== null && _poolMetadata$ethRese !== void 0 ? _poolMetadata$ethRese : 1);\n  const tokenReserves = BigNumber.from((_poolMetadata$tokenRe = nft === null || nft === void 0 ? void 0 : (_poolMetadata4 = nft.poolMetadata) === null || _poolMetadata4 === void 0 ? void 0 : (_poolMetadata4$tokenR = _poolMetadata4.tokenReserves) === null || _poolMetadata4$tokenR === void 0 ? void 0 : _poolMetadata4$tokenR.toLocaleString('fullwide', {\n    useGrouping: false\n  })) !== null && _poolMetadata$tokenRe !== void 0 ? _poolMetadata$tokenRe : 1);\n  const numerator = ethReserves.mul(amountToBuy).mul(1000);\n  const denominator = tokenReserves.sub(amountToBuy).mul(997);\n  const marginalnumerator = ethReserves.mul(marginalBuy).mul(1000);\n  const marginaldenominator = tokenReserves.sub(marginalBuy).mul(997);\n  let price = numerator.div(denominator);\n  const marginalprice = marginalnumerator.div(marginaldenominator);\n  price = price.sub(marginalprice);\n  price = price.mul(101).div(100);\n  return price.toString();\n};\nexport const calcPoolPrice = function (asset) {\n  var _calcSudoSwapPrice;\n  let position = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  if (!asset.sellorders) return '';\n  if (asset.marketplace === Markets.Sudoswap) return (_calcSudoSwapPrice = calcSudoSwapPrice(asset, position)) !== null && _calcSudoSwapPrice !== void 0 ? _calcSudoSwapPrice : '0';\n  return calcAmmBasedPoolprice(asset, position);\n};\nexport const calcAvgGroupPoolPrice = (asset, numberOfAssets) => {\n  let total = BigNumber.from(0);\n  for (let i = 0; i < numberOfAssets; i++) {\n    if (asset.marketplace === Markets.Sudoswap) {\n      var _calcSudoSwapPrice2;\n      total = total.add(BigNumber.from((_calcSudoSwapPrice2 = calcSudoSwapPrice(asset, i)) !== null && _calcSudoSwapPrice2 !== void 0 ? _calcSudoSwapPrice2 : '0'));\n    } else {\n      total = total.add(BigNumber.from(calcPoolPrice(asset, i)));\n    }\n  }\n  return total.div(numberOfAssets).toString();\n};\nconst recalculatePooledAssetPrice = (asset, position) => {\n  var _calcSudoSwapPrice3;\n  return asset.marketplace === Markets.Sudoswap ? (_calcSudoSwapPrice3 = calcSudoSwapPrice(asset, position)) !== null && _calcSudoSwapPrice3 !== void 0 ? _calcSudoSwapPrice3 : '' : calcPoolPrice(asset, position);\n};\nexport const recalculateBagUsingPooledAssets = uncheckedItemsInBag => {\n  if (!uncheckedItemsInBag.some(item => item.asset.marketplace && isPooledMarket(item.asset.marketplace)) || uncheckedItemsInBag.every(item => item.status === BagItemStatus.REVIEWED || item.status === BagItemStatus.REVIEWING_PRICE_CHANGE)) return uncheckedItemsInBag;\n  const itemsInBag = [...uncheckedItemsInBag];\n  itemsInBag.forEach(item => {\n    if (item.asset.marketplace) if (isPooledMarket(item.asset.marketplace)) {\n      const asset = item.asset;\n      const isPriceChangedAsset = !!asset.updatedPriceInfo;\n      const itemsInPool = asset.marketplace === Markets.Sudoswap ? itemsInBag.filter(bagItem => isInSameSudoSwapPool(item.asset, bagItem.asset)) : itemsInBag.filter(bagItem => isInSameMarketplaceCollection(item.asset, bagItem.asset));\n      const calculatedPrice = isPriceChangedAsset ? calcAvgGroupPoolPrice(asset, itemsInPool.length) : recalculatePooledAssetPrice(asset, itemsInPool.findIndex(itemInPool => itemInPool.asset.tokenId === asset.tokenId));\n      if (isPriceChangedAsset && item.asset.updatedPriceInfo) item.asset.updatedPriceInfo.ETHPrice = item.asset.updatedPriceInfo.basePrice = calculatedPrice;else item.asset.priceInfo.ETHPrice = calculatedPrice;\n    }\n  });\n  return itemsInBag;\n};","map":{"version":3,"names":["BigNumber","BagItemStatus","isPooledMarket","Markets","isInSameMarketplaceCollection","isInSameSudoSwapPool","PRECISION","PROTOCOL_FEE_MULTIPLIER","from","BondingCurve","getPoolParameters","protocolParameters","delta","undefined","fee","ammFeeFixed","spotPrice","poolMetadata","bondingCurve","calculateScaledPrice","currentPrice","poolFee","protocolFee","mul","div","tradeFee","add","calcSudoSwapLinearBondingCurve","position","i","calcSudoSwapExponentialBondingCurve","calcSudoSwapXykBondingCurve","sudoSwapPool","virtualTokenBalance","virtualNFTBalance","sub","gt","isZero","calcSudoSwapPrice","asset","sellorders","sudoSwapParameters","Linear","Exponential","Xyk","xykCurrentPrice","toString","calcAmmBasedPoolprice","amountToBuy","marginalBuy","nft","decimals","pow","ammFee","ammFeePercent","marketplace","NFTX","sixteenmul","NFT20","ethReserves","toLocaleString","useGrouping","tokenReserves","numerator","denominator","marginalnumerator","marginaldenominator","price","marginalprice","calcPoolPrice","Sudoswap","calcAvgGroupPoolPrice","numberOfAssets","total","recalculatePooledAssetPrice","recalculateBagUsingPooledAssets","uncheckedItemsInBag","some","item","every","status","REVIEWED","REVIEWING_PRICE_CHANGE","itemsInBag","forEach","isPriceChangedAsset","updatedPriceInfo","itemsInPool","filter","bagItem","calculatedPrice","length","findIndex","itemInPool","tokenId","ETHPrice","basePrice","priceInfo"],"sources":["/home/diep/freelance/interface/src/nft/utils/pooledAssets.ts"],"sourcesContent":["import { BigNumber } from '@ethersproject/bignumber'\nimport { BagItem, BagItemStatus, GenieAsset, isPooledMarket, Markets } from 'nft/types'\nimport { isInSameMarketplaceCollection, isInSameSudoSwapPool } from 'nft/utils'\n\nconst PRECISION = '1000000000000000000'\nconst PROTOCOL_FEE_MULTIPLIER = BigNumber.from('5000000000000000')\n\nenum BondingCurve {\n  Linear = 'LINEAR',\n  Exponential = 'EXPONENTIAL',\n  Xyk = 'XYK',\n}\n\ninterface Pool {\n  delta?: string\n  spotPrice?: string\n  fee?: string\n  bondingCurve?: BondingCurve\n}\n\nconst getPoolParameters = (protocolParameters: Record<string, unknown>): Pool => {\n  return {\n    delta: protocolParameters?.delta ? (protocolParameters.delta as string) : undefined,\n    fee: protocolParameters?.ammFeeFixed ? (protocolParameters.ammFeeFixed as string) : undefined,\n    spotPrice: (protocolParameters as Record<string, { spotPrice?: string }>)?.poolMetadata?.spotPrice,\n    bondingCurve: (protocolParameters as Record<string, { bondingCurve?: BondingCurve }>)?.poolMetadata?.bondingCurve,\n  }\n}\n\nconst calculateScaledPrice = (currentPrice: BigNumber, poolFee: BigNumber): BigNumber => {\n  const protocolFee = currentPrice.mul(PROTOCOL_FEE_MULTIPLIER).div(BigNumber.from(PRECISION))\n  const tradeFee = currentPrice.mul(poolFee).div(BigNumber.from(PRECISION))\n  return currentPrice.add(protocolFee).add(tradeFee)\n}\n\nconst calcSudoSwapLinearBondingCurve = (currentPrice: BigNumber, delta: BigNumber, position = 0): BigNumber => {\n  for (let i = 0; i <= position; i++) {\n    currentPrice = currentPrice.add(delta)\n  }\n\n  return currentPrice\n}\n\nconst calcSudoSwapExponentialBondingCurve = (currentPrice: BigNumber, delta: BigNumber, position = 0): BigNumber => {\n  for (let i = 0; i <= position; i++) {\n    currentPrice = currentPrice.mul(delta).div(BigNumber.from(PRECISION))\n  }\n\n  return currentPrice\n}\n\nconst calcSudoSwapXykBondingCurve = (\n  currentPrice: BigNumber,\n  sudoSwapPool: Pool,\n  position = 0\n): BigNumber | undefined => {\n  let virtualTokenBalance = BigNumber.from(sudoSwapPool.spotPrice)\n  let virtualNFTBalance = BigNumber.from(sudoSwapPool.delta)\n\n  if (virtualNFTBalance.sub(BigNumber.from(1)).gt(BigNumber.from(0))) {\n    currentPrice = virtualTokenBalance.div(virtualNFTBalance.sub(BigNumber.from(1)))\n  } else {\n    return undefined\n  }\n\n  for (let i = 1; i <= position; i++) {\n    virtualTokenBalance = virtualTokenBalance.add(currentPrice)\n    virtualNFTBalance = virtualNFTBalance.sub(BigNumber.from(1))\n\n    if (!virtualNFTBalance.sub(BigNumber.from(1)).isZero()) {\n      currentPrice = virtualTokenBalance.div(virtualNFTBalance.sub(BigNumber.from(1)))\n    } else {\n      return undefined\n    }\n  }\n\n  return currentPrice\n}\n\nexport const calcSudoSwapPrice = (asset: GenieAsset, position = 0): string | undefined => {\n  if (!asset.sellorders) return undefined\n\n  const sudoSwapParameters = asset.sellorders[0].protocolParameters\n  const sudoSwapPool = getPoolParameters(sudoSwapParameters)\n\n  if (!sudoSwapPool.fee || !sudoSwapPool.delta || !sudoSwapPool.spotPrice || !sudoSwapPool.bondingCurve)\n    return undefined\n\n  let currentPrice = BigNumber.from(sudoSwapPool.spotPrice)\n  const delta = BigNumber.from(sudoSwapPool.delta)\n  const poolFee = BigNumber.from(sudoSwapPool.fee)\n\n  if (sudoSwapPool.bondingCurve === BondingCurve.Linear) {\n    currentPrice = calcSudoSwapLinearBondingCurve(currentPrice, delta, position)\n  } else if (sudoSwapPool.bondingCurve === BondingCurve.Exponential) {\n    currentPrice = calcSudoSwapExponentialBondingCurve(currentPrice, delta, position)\n  } else if (sudoSwapPool.bondingCurve === BondingCurve.Xyk) {\n    const xykCurrentPrice = calcSudoSwapXykBondingCurve(currentPrice, sudoSwapPool, position)\n    if (xykCurrentPrice) {\n      currentPrice = xykCurrentPrice\n    } else {\n      return undefined\n    }\n  } else {\n    return undefined\n  }\n\n  return calculateScaledPrice(currentPrice, poolFee).toString()\n}\n\nconst calcAmmBasedPoolprice = (asset: GenieAsset, position = 0): string => {\n  if (!asset.sellorders) return ''\n\n  let amountToBuy: BigNumber = BigNumber.from(0)\n  let marginalBuy: BigNumber = BigNumber.from(0)\n\n  const nft = asset.sellorders[0].protocolParameters\n  const decimals = BigNumber.from(1).mul(10).pow(18)\n  const ammFee = nft?.ammFeePercent ? (100 + (nft.ammFeePercent as number)) * 100 : 110 * 100\n\n  if (asset.marketplace === Markets.NFTX) {\n    const sixteenmul = BigNumber.from(1).mul(10).pow(16)\n    amountToBuy = BigNumber.from(ammFee)\n      .div(100)\n      .mul(position + 1)\n    amountToBuy = amountToBuy.mul(sixteenmul)\n\n    marginalBuy = BigNumber.from(ammFee).div(100).mul(position)\n    marginalBuy = marginalBuy.mul(sixteenmul)\n  }\n  if (asset.marketplace === Markets.NFT20) {\n    amountToBuy = BigNumber.from(100).mul(position + 1)\n    amountToBuy = amountToBuy.mul(decimals)\n\n    marginalBuy = BigNumber.from(100).mul(position)\n    marginalBuy = marginalBuy.mul(decimals)\n  }\n\n  const ethReserves = BigNumber.from(\n    (\n      nft as Record<\n        string,\n        {\n          ethReserves: number\n        }\n      >\n    )?.poolMetadata?.ethReserves?.toLocaleString('fullwide', { useGrouping: false }) ?? 1\n  )\n  const tokenReserves = BigNumber.from(\n    (\n      nft as Record<\n        string,\n        {\n          tokenReserves: number\n        }\n      >\n    )?.poolMetadata?.tokenReserves?.toLocaleString('fullwide', { useGrouping: false }) ?? 1\n  )\n  const numerator = ethReserves.mul(amountToBuy).mul(1000)\n  const denominator = tokenReserves.sub(amountToBuy).mul(997)\n\n  const marginalnumerator = ethReserves.mul(marginalBuy).mul(1000)\n  const marginaldenominator = tokenReserves.sub(marginalBuy).mul(997)\n\n  let price = numerator.div(denominator)\n  const marginalprice = marginalnumerator.div(marginaldenominator)\n\n  price = price.sub(marginalprice)\n  price = price.mul(101).div(100)\n\n  return price.toString()\n}\n\nexport const calcPoolPrice = (asset: GenieAsset, position = 0): string => {\n  if (!asset.sellorders) return ''\n  if (asset.marketplace === Markets.Sudoswap) return calcSudoSwapPrice(asset, position) ?? '0'\n  return calcAmmBasedPoolprice(asset, position)\n}\n\nexport const calcAvgGroupPoolPrice = (asset: GenieAsset, numberOfAssets: number) => {\n  let total = BigNumber.from(0)\n\n  for (let i = 0; i < numberOfAssets; i++) {\n    if (asset.marketplace === Markets.Sudoswap) {\n      total = total.add(BigNumber.from(calcSudoSwapPrice(asset, i) ?? '0'))\n    } else {\n      total = total.add(BigNumber.from(calcPoolPrice(asset, i)))\n    }\n  }\n\n  return total.div(numberOfAssets).toString()\n}\n\nconst recalculatePooledAssetPrice = (asset: GenieAsset, position: number): string => {\n  return asset.marketplace === Markets.Sudoswap\n    ? calcSudoSwapPrice(asset, position) ?? ''\n    : calcPoolPrice(asset, position)\n}\n\nexport const recalculateBagUsingPooledAssets = (uncheckedItemsInBag: BagItem[]) => {\n  if (\n    !uncheckedItemsInBag.some((item) => item.asset.marketplace && isPooledMarket(item.asset.marketplace)) ||\n    uncheckedItemsInBag.every(\n      (item) => item.status === BagItemStatus.REVIEWED || item.status === BagItemStatus.REVIEWING_PRICE_CHANGE\n    )\n  )\n    return uncheckedItemsInBag\n\n  const itemsInBag = [...uncheckedItemsInBag]\n  itemsInBag.forEach((item) => {\n    if (item.asset.marketplace)\n      if (isPooledMarket(item.asset.marketplace)) {\n        const asset = item.asset\n        const isPriceChangedAsset = !!asset.updatedPriceInfo\n\n        const itemsInPool =\n          asset.marketplace === Markets.Sudoswap\n            ? itemsInBag.filter((bagItem) => isInSameSudoSwapPool(item.asset, bagItem.asset))\n            : itemsInBag.filter((bagItem) => isInSameMarketplaceCollection(item.asset, bagItem.asset))\n        const calculatedPrice = isPriceChangedAsset\n          ? calcAvgGroupPoolPrice(asset, itemsInPool.length)\n          : recalculatePooledAssetPrice(\n              asset,\n              itemsInPool.findIndex((itemInPool) => itemInPool.asset.tokenId === asset.tokenId)\n            )\n\n        if (isPriceChangedAsset && item.asset.updatedPriceInfo)\n          item.asset.updatedPriceInfo.ETHPrice = item.asset.updatedPriceInfo.basePrice = calculatedPrice\n        else item.asset.priceInfo.ETHPrice = calculatedPrice\n      }\n  })\n\n  return itemsInBag\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}